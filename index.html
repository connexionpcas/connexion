<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>CONNEXiON üéÆ ‚Äî Multiplayer</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800;900&display=swap"
    rel="stylesheet" />

  <!-- ‚ïê‚ïê‚ïê FIREBASE SDK ‚ïê‚ïê‚ïê -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

  <style>
    :root {
      --bg: #0d0d1a;
      --card: #1a1a2e;
      --card2: #16213e;
      --accent: #f72585;
      --accent2: #7209b7;
      --accent3: #3a0ca3;
      --neon: #4cc9f0;
      --green: #06d6a0;
      --yellow: #ffd166;
      --red: #ef233c;
      --text: #f8f9fa;
      --muted: #8899aa;
      --border: rgba(76, 201, 240, 0.2);
      --radius: 16px;
      --shadow: 0 8px 32px rgba(247, 37, 133, 0.15);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent
    }

    html,
    body {
      height: 100%;
      overflow: hidden;
      font-family: 'Nunito', sans-serif;
      background: var(--bg);
      color: var(--text)
    }

    /* ‚îÄ‚îÄ SETUP BANNER ‚îÄ‚îÄ */
    .setup-banner {
      background: linear-gradient(135deg, rgba(247, 37, 133, .15), rgba(114, 9, 183, .15));
      border: 1.5px solid rgba(247, 37, 133, .4);
      border-radius: 12px;
      padding: 14px 16px;
      font-size: 13px;
      line-height: 1.7;
      margin-bottom: 14px;
      color: var(--text)
    }

    .setup-banner strong {
      color: var(--neon)
    }

    .setup-banner code {
      background: rgba(255, 255, 255, .1);
      padding: 1px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      color: var(--yellow)
    }

    /* ‚îÄ‚îÄ TAB BAR ‚îÄ‚îÄ */
    .tab-bar {
      display: flex;
      background: var(--card);
      border-bottom: 2px solid var(--border);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      height: 56px
    }

    .tab-btn {
      flex: 1;
      border: none;
      background: transparent;
      color: var(--muted);
      font-family: 'Fredoka One', cursive;
      font-size: 17px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: all .2s;
      position: relative
    }

    .tab-btn.active {
      color: var(--neon)
    }

    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 10%;
      right: 10%;
      height: 3px;
      background: var(--neon);
      border-radius: 3px 3px 0 0
    }

    /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
    .screen {
      position: fixed;
      top: 56px;
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      display: none;
      padding: 20px 16px 40px
    }

    .screen.active {
      display: block
    }

    /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--shadow)
    }

    .card-title {
      font-family: 'Fredoka One', cursive;
      font-size: 20px;
      color: var(--neon);
      margin-bottom: 16px
    }

    /* ‚îÄ‚îÄ INPUTS ‚îÄ‚îÄ */
    input[type=text],
    input[type=password] {
      width: 100%;
      padding: 14px 16px;
      border-radius: 12px;
      border: 2px solid var(--border);
      background: var(--bg);
      color: var(--text);
      font-family: 'Nunito', sans-serif;
      font-size: 16px;
      outline: none;
      margin-bottom: 12px;
      transition: border .2s
    }

    input:focus {
      border-color: var(--neon)
    }

    /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
    .btn {
      width: 100%;
      padding: 15px;
      border-radius: 12px;
      border: none;
      font-family: 'Fredoka One', cursive;
      font-size: 18px;
      cursor: pointer;
      transition: all .2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 10px
    }

    .btn:active {
      transform: scale(.97)
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #fff
    }

    .btn-secondary {
      background: linear-gradient(135deg, var(--accent3), var(--neon));
      color: #fff
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--red), #900);
      color: #fff
    }

    .btn-success {
      background: linear-gradient(135deg, var(--green), #048a68);
      color: #fff
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--border);
      color: var(--neon);
      font-family: 'Fredoka One', cursive;
      font-size: 16px
    }

    .btn-sm {
      padding: 8px 16px;
      font-size: 14px;
      width: auto;
      border-radius: 8px;
      margin-bottom: 0
    }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero {
      text-align: center;
      padding: 20px 0 10px
    }

    .hero h1 {
      font-family: 'Fredoka One', cursive;
      font-size: 32px;
      line-height: 1.1;
      background: linear-gradient(135deg, var(--neon), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent
    }

    .hero p {
      color: var(--muted);
      font-size: 14px;
      margin-top: 6px
    }

    /* ‚îÄ‚îÄ ROOM CODE ‚îÄ‚îÄ */
    .room-code-display {
      background: linear-gradient(135deg, var(--accent3), var(--accent2));
      border-radius: 14px;
      padding: 20px;
      text-align: center;
      margin-bottom: 16px
    }

    .room-code-display .label {
      font-size: 12px;
      color: rgba(255, 255, 255, .7);
      letter-spacing: 2px;
      text-transform: uppercase
    }

    .room-code-display .code {
      font-family: 'Fredoka One', cursive;
      font-size: 42px;
      color: #fff;
      letter-spacing: 8px;
      margin: 6px 0
    }

    .room-code-display .sub {
      font-size: 12px;
      color: rgba(255, 255, 255, .6)
    }

    /* ‚îÄ‚îÄ TIMER ‚îÄ‚îÄ */
    .timer-ring-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 8px 0
    }

    .timer-svg {
      transform: rotate(-90deg)
    }

    .timer-bg {
      fill: none;
      stroke: rgba(255, 255, 255, .1);
      stroke-width: 6
    }

    .timer-arc {
      fill: none;
      stroke: var(--neon);
      stroke-width: 6;
      stroke-linecap: round;
      transition: stroke-dashoffset 1s linear, stroke .3s
    }

    .timer-text {
      font-family: 'Fredoka One', cursive;
      font-size: 28px;
      fill: var(--text);
      text-anchor: middle;
      dominant-baseline: central
    }

    /* ‚îÄ‚îÄ CLUE CHIPS ‚îÄ‚îÄ */
    .clue-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin: 12px 0;
      justify-content: center;
    }

    .clue-chip {
      background: linear-gradient(135deg, var(--accent3), var(--accent2));
      border-radius: 16px;
      padding: 18px 24px;
      font-size: 48px;
      line-height: 1;
      box-shadow: 0 4px 16px rgba(114, 9, 183, 0.35);
      text-align: center;
      min-width: 80px;
    }

    .clue-chip-host {
      background: linear-gradient(135deg, var(--accent3), var(--accent2));
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 32px;
      line-height: 1;
      text-align: center;
      min-width: 60px;
    }

    /* ‚îÄ‚îÄ CHANCES ‚îÄ‚îÄ */
    .chances {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 8px 0
    }

    .heart {
      font-size: 26px;
      transition: all .3s
    }

    .heart.lost {
      filter: grayscale(1) opacity(.25);
      transform: scale(.75)
    }

    /* ‚îÄ‚îÄ ANSWER INPUT ‚îÄ‚îÄ */
    .answer-area {
      display: flex;
      gap: 8px
    }

    .answer-area input {
      margin-bottom: 0;
      flex: 1
    }

    .answer-area button {
      width: auto;
      padding: 14px 18px;
      border-radius: 12px;
      font-size: 22px;
      margin-bottom: 0;
      border: none;
      cursor: pointer;
      background: var(--neon);
      color: var(--bg);
      font-weight: 900
    }

    /* ‚îÄ‚îÄ REVEAL BANNER ‚îÄ‚îÄ */
    .reveal-banner {
      background: linear-gradient(135deg, var(--green), #048a68);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      margin: 10px 0
    }

    .reveal-banner .answer-word {
      font-family: 'Fredoka One', cursive;
      font-size: 30px;
      color: #fff;
      letter-spacing: 3px
    }

    .reveal-banner .sub {
      font-size: 13px;
      color: rgba(255, 255, 255, .8);
      margin-top: 4px
    }

    /* ‚îÄ‚îÄ DEDUCT BANNER ‚îÄ‚îÄ */
    .deduct-banner {
      background: linear-gradient(135deg, #c1121f, #6a040f);
      border-radius: 12px;
      padding: 14px;
      text-align: center;
      margin: 10px 0;
      border: 1px solid rgba(239, 35, 60, .4)
    }

    .deduct-banner .deduct-word {
      font-family: 'Fredoka One', cursive;
      font-size: 24px;
      color: #fff
    }

    .deduct-banner .deduct-sub {
      font-size: 13px;
      color: rgba(255, 255, 255, .75);
      margin-top: 4px
    }

    /* ‚îÄ‚îÄ PLAYER TABLE ‚îÄ‚îÄ */
    .player-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px
    }

    .player-table th {
      color: var(--muted);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 8px 6px;
      text-align: left;
      border-bottom: 1px solid var(--border)
    }

    .player-table td {
      padding: 10px 6px;
      border-bottom: 1px solid rgba(255, 255, 255, .05)
    }

    .player-table tr:last-child td {
      border-bottom: none
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px
    }

    .status-dot.online {
      background: var(--green);
      box-shadow: 0 0 6px var(--green)
    }

    .status-dot.left {
      background: var(--red)
    }

    .status-dot.aborted {
      background: var(--yellow)
    }

    /* ‚îÄ‚îÄ BADGES ‚îÄ‚îÄ */
    .badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700
    }

    .badge-correct {
      background: rgba(6, 214, 160, .2);
      color: var(--green)
    }

    .badge-wrong {
      background: rgba(239, 35, 60, .2);
      color: var(--red)
    }

    .badge-timeout {
      background: rgba(255, 209, 102, .2);
      color: var(--yellow)
    }

    .badge-waiting {
      background: rgba(76, 201, 240, .2);
      color: var(--neon)
    }

    .badge-failed {
      background: rgba(239, 35, 60, .3);
      color: #ff6b8a
    }

    /* ‚îÄ‚îÄ SCOREBOARD ‚îÄ‚îÄ */
    .score-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid var(--border)
    }

    .score-row:last-child {
      border-bottom: none
    }

    .score-row .rank {
      font-family: 'Fredoka One', cursive;
      font-size: 22px;
      color: var(--muted);
      width: 32px
    }

    .score-row .rank.gold {
      color: #ffd700
    }

    .score-row .rank.silver {
      color: #c0c0c0
    }

    .score-row .rank.bronze {
      color: #cd7f32
    }

    .score-row .name {
      flex: 1;
      font-weight: 700;
      font-size: 15px;
      padding: 0 10px
    }

    .score-row .pts {
      font-family: 'Fredoka One', cursive;
      font-size: 24px;
      color: var(--accent)
    }

    /* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
    .q-progress {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px
    }

    .q-progress .label {
      font-size: 13px;
      color: var(--muted);
      white-space: nowrap
    }

    .progress-bar {
      flex: 1;
      height: 6px;
      background: rgba(255, 255, 255, .1);
      border-radius: 3px;
      overflow: hidden
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--neon));
      border-radius: 3px;
      transition: width .3s
    }

    /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
    .toast {
      position: fixed;
      top: 70px;
      left: 50%;
      transform: translateX(-50%) translateY(-80px);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 24px;
      font-weight: 700;
      font-size: 14px;
      z-index: 999;
      transition: transform .3s;
      box-shadow: 0 4px 20px rgba(0, 0, 0, .4);
      text-align: center;
      max-width: 290px;
      pointer-events: none
    }

    .toast.show {
      transform: translateX(-50%) translateY(0)
    }

    .toast.success {
      border-color: var(--green);
      color: var(--green)
    }

    .toast.error {
      border-color: var(--red);
      color: var(--red)
    }

    .toast.info {
      border-color: var(--neon);
      color: var(--neon)
    }

    .toast.warn {
      border-color: var(--yellow);
      color: var(--yellow)
    }

    /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .88);
      z-index: 200;
      align-items: center;
      justify-content: center;
      padding: 20px;
      display: none
    }

    .modal-overlay.open {
      display: flex
    }

    .modal {
      background: var(--card);
      border-radius: 20px;
      padding: 28px 24px;
      width: 100%;
      max-width: 340px;
      border: 1px solid var(--border);
      text-align: center
    }

    .modal h2 {
      font-family: 'Fredoka One', cursive;
      font-size: 24px;
      margin-bottom: 12px
    }

    .modal p {
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 20px;
      line-height: 1.6
    }

    /* ‚îÄ‚îÄ ABORT ‚îÄ‚îÄ */
    .abort-screen {
      position: fixed;
      inset: 0;
      background: #0d0d1a;
      z-index: 500;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 32px
    }

    .abort-screen.show {
      display: flex
    }

    .abort-emoji {
      font-size: 80px;
      margin-bottom: 20px
    }

    .abort-screen h2 {
      font-family: 'Fredoka One', cursive;
      font-size: 28px;
      color: var(--red);
      margin-bottom: 12px
    }

    .abort-screen p {
      color: var(--muted);
      font-size: 15px;
      line-height: 1.6
    }

    /* ‚îÄ‚îÄ Q NUMBER ‚îÄ‚îÄ */
    .q-number {
      font-family: 'Fredoka One', cursive;
      font-size: 13px;
      color: var(--muted);
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-bottom: 4px
    }

    /* ‚îÄ‚îÄ PODIUM ‚îÄ‚îÄ */
    .podium {
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: 8px;
      margin: 20px 0
    }

    .podium-slot {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px
    }

    .podium-block {
      width: 80px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      padding-bottom: 8px;
      border-radius: 8px 8px 0 0
    }

    .podium-block.first {
      height: 90px;
      background: linear-gradient(135deg, #ffd700, #ff9900)
    }

    .podium-block.second {
      height: 65px;
      background: linear-gradient(135deg, #aaa, #777)
    }

    .podium-block.third {
      height: 48px;
      background: linear-gradient(135deg, #cd7f32, #8b4513)
    }

    .podium-name {
      font-size: 11px;
      font-weight: 800;
      text-align: center;
      word-break: break-word;
      color: rgba(255, 255, 255, .9);
      padding: 0 4px
    }

    /* ‚îÄ‚îÄ DASH TABS ‚îÄ‚îÄ */
    .dash-tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 14px;
      overflow-x: auto;
      padding-bottom: 2px
    }

    .dash-tab {
      padding: 7px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      border: 1.5px solid var(--border);
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      white-space: nowrap;
      transition: all .2s
    }

    .dash-tab.active {
      background: var(--neon);
      color: var(--bg);
      border-color: var(--neon)
    }

    /* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
    @keyframes pulse {

      0%,
      100% {
        transform: scale(1)
      }

      50% {
        transform: scale(1.05)
      }
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0)
      }

      25% {
        transform: translateX(-8px)
      }

      75% {
        transform: translateX(8px)
      }
    }

    @keyframes pop {
      0% {
        transform: scale(.5);
        opacity: 0
      }

      80% {
        transform: scale(1.1)
      }

      100% {
        transform: scale(1);
        opacity: 1
      }
    }

    @keyframes slideUp {
      from {
        transform: translateY(30px);
        opacity: 0
      }

      to {
        transform: translateY(0);
        opacity: 1
      }
    }

    @keyframes flashGreen {

      0%,
      100% {
        background: var(--card)
      }

      50% {
        background: rgba(6, 214, 160, .25)
      }
    }

    @keyframes flashRed {

      0%,
      100% {
        background: var(--card)
      }

      50% {
        background: rgba(239, 35, 60, .25)
      }
    }

    .anim-pop {
      animation: pop .4s ease
    }

    .anim-shake {
      animation: shake .4s ease
    }

    .anim-slide {
      animation: slideUp .35s ease
    }

    .flash-correct {
      animation: flashGreen .5s ease
    }

    .flash-wrong {
      animation: flashRed .5s ease
    }

    /* ‚îÄ‚îÄ PILLS ‚îÄ‚îÄ */
    .pill-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 12px
    }

    .pill {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      background: rgba(255, 255, 255, .07)
    }

    .pill span {
      color: var(--neon)
    }

    /* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
    .empty {
      text-align: center;
      color: var(--muted);
      padding: 30px;
      font-size: 14px
    }

    .empty .icon {
      font-size: 36px;
      display: block;
      margin-bottom: 8px
    }

    /* ‚îÄ‚îÄ HOST ANSWER BOX ‚îÄ‚îÄ */
    .host-answer-box {
      margin-top: 10px;
      padding: 10px 14px;
      border-radius: 10px;
      background: rgba(6, 214, 160, .1);
      border: 1.5px solid rgba(6, 214, 160, .35);
      display: flex;
      align-items: center;
      gap: 10px
    }

    .host-answer-box .ans-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--green);
      font-weight: 700;
      white-space: nowrap
    }

    .host-answer-box .ans-word {
      font-family: 'Fredoka One', cursive;
      font-size: 22px;
      color: #fff;
      letter-spacing: 3px
    }

    .host-hint-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 5px 12px;
      border-radius: 20px;
      background: rgba(255, 209, 102, .15);
      border: 1px solid rgba(255, 209, 102, .3);
      font-size: 12px;
      color: var(--yellow);
      font-weight: 700;
      margin-top: 7px;
      flex-wrap: wrap;
      line-height: 1.5
    }

    /* ‚îÄ‚îÄ HINT BOX ‚îÄ‚îÄ */
    .hint-box {
      margin: 8px 0;
      border-radius: 12px;
      overflow: hidden;
      border: 1.5px solid rgba(255, 209, 102, .3)
    }

    .hint-row {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 9px 14px;
      background: rgba(255, 209, 102, .06);
      border-bottom: 1px solid rgba(255, 209, 102, .12);
      font-size: 13px;
      transition: background .4s
    }

    .hint-row:last-child {
      border-bottom: none
    }

    .hint-row.locked {
      opacity: .35
    }

    .hint-row.unlocked {
      opacity: 1
    }

    .hint-icon {
      font-size: 16px;
      flex-shrink: 0
    }

    .hint-label {
      font-size: 11px;
      color: var(--yellow);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      min-width: 70px
    }

    .hint-value {
      color: var(--text);
      font-weight: 700;
      font-size: 14px;
      letter-spacing: 2px;
      font-family: 'Fredoka One', cursive
    }

    .hint-value.masked {
      color: var(--muted);
      letter-spacing: 4px
    }

    /* ‚îÄ‚îÄ SOLVED BAR ‚îÄ‚îÄ */
    .solved-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 14px;
      background: rgba(6, 214, 160, .08);
      border: 1px solid rgba(6, 214, 160, .2);
      border-radius: 10px;
      margin-bottom: 10px
    }

    .solved-bar .solved-text {
      font-size: 13px;
      color: var(--green);
      font-weight: 700
    }

    .solved-bar .solved-count {
      font-family: 'Fredoka One', cursive;
      font-size: 20px;
      color: var(--green)
    }

    /* ‚îÄ‚îÄ DEDUCT FLASH ‚îÄ‚îÄ */
    .deduct-flash {
      font-family: 'Fredoka One', cursive;
      font-size: 18px;
      color: var(--red);
      text-align: center;
      padding: 6px;
      animation: pop .4s ease
    }

    /* ‚îÄ‚îÄ AUTO NEXT ‚îÄ‚îÄ */
    .auto-next-bar {
      margin-top: 10px;
      height: 5px;
      border-radius: 3px;
      background: rgba(255, 255, 255, .1);
      overflow: hidden
    }

    .auto-next-fill {
      height: 100%;
      background: var(--green);
      border-radius: 3px;
      transition: width 1s linear
    }

    .auto-next-label {
      text-align: center;
      font-size: 12px;
      color: var(--green);
      margin-top: 5px;
      font-weight: 700
    }

    /* ‚îÄ‚îÄ FINAL DASHBOARD ‚îÄ‚îÄ */
    .final-stat-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 4px
    }

    .final-stat {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px;
      text-align: center
    }

    .final-stat .fs-val {
      font-family: 'Fredoka One', cursive;
      font-size: 28px;
      color: var(--neon)
    }

    .final-stat .fs-label {
      font-size: 12px;
      color: var(--muted);
      margin-top: 3px
    }

    .mvp-card {
      background: linear-gradient(135deg, rgba(247, 37, 133, .15), rgba(114, 9, 183, .15));
      border: 1.5px solid rgba(247, 37, 133, .3);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 12px
    }

    .mvp-icon {
      font-size: 32px;
      flex-shrink: 0
    }

    .mvp-name {
      font-family: 'Fredoka One', cursive;
      font-size: 17px;
      color: var(--text)
    }

    .mvp-desc {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px
    }

    .mvp-val {
      font-family: 'Fredoka One', cursive;
      font-size: 22px;
      color: var(--accent);
      margin-left: auto;
      flex-shrink: 0
    }

    .end-game-btn {
      background: linear-gradient(135deg, #ff6b35, #c1121f);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 15px;
      width: 100%;
      font-family: 'Fredoka One', cursive;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 10px;
      transition: all .2s
    }

    .end-game-btn:active {
      transform: scale(.97)
    }

    /* ‚îÄ‚îÄ REJOIN NOTIFICATIONS ‚îÄ‚îÄ */
    .notif-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 300;
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 8px 12px;
      pointer-events: none;
    }

    .notif-card {
      background: var(--card);
      border: 1.5px solid var(--yellow);
      border-radius: 14px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, .5);
      animation: slideUp .3s ease;
      pointer-events: all;
    }

    .notif-card .notif-text {
      flex: 1;
      font-size: 13px;
      font-weight: 700;
      color: var(--text);
    }

    .notif-card .notif-sub {
      font-size: 11px;
      color: var(--muted);
      font-weight: 400;
    }

    .notif-btn-row {
      display: flex;
      gap: 6px;
    }

    .notif-btn {
      border: none;
      border-radius: 8px;
      padding: 7px 14px;
      font-family: 'Fredoka One', cursive;
      font-size: 13px;
      cursor: pointer;
      transition: opacity .2s;
    }

    .notif-btn:active {
      opacity: .75;
    }

    .notif-btn.approve {
      background: var(--green);
      color: #fff;
    }

    .notif-btn.deny {
      background: var(--red);
      color: #fff;
    }

    /* Rejoin request button on abort screen */
    .rejoin-btn {
      margin-top: 20px;
      background: linear-gradient(135deg, var(--accent3), var(--neon));
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 14px 28px;
      font-family: 'Fredoka One', cursive;
      font-size: 18px;
      cursor: pointer;
      transition: all .2s;
    }

    .rejoin-btn:active {
      transform: scale(.97);
    }

    .rejoin-status {
      margin-top: 14px;
      font-size: 14px;
      color: var(--muted);
      font-weight: 700;
    }

    .conn-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      margin-bottom: 10px
    }

    .conn-badge.connected {
      background: rgba(6, 214, 160, .15);
      color: var(--green);
      border: 1px solid rgba(6, 214, 160, .3)
    }

    .conn-badge.disconnected {
      background: rgba(239, 35, 60, .15);
      color: var(--red);
      border: 1px solid rgba(239, 35, 60, .3)
    }

    .conn-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: currentColor
    }

    /* ‚ïê‚ïê RULES SCREEN ‚ïê‚ïê */
    #player-rules {
      padding: 0 !important;
      display: none;
      flex-direction: column;
    }
    #player-rules.active {
      display: flex !important;
    }
    .rules-header {
      padding: 16px 18px 0;
      flex-shrink: 0;
      text-align: center;
    }
    .rules-header h2 {
      font-family: 'Fredoka One', cursive;
      font-size: 22px;
      background: linear-gradient(135deg, var(--neon), var(--accent));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .rules-header p {
      color: var(--muted);
      font-size: 12px;
      margin-top: 3px;
    }
    /* tab pills */
    .r-tab-wrap {
      padding: 10px 16px 0;
      flex-shrink: 0;
      overflow-x: auto;
      scrollbar-width: none;
    }
    .r-tab-wrap::-webkit-scrollbar { display: none; }
    .r-tab-strip {
      display: flex;
      gap: 7px;
      width: max-content;
      min-width: 100%;
      justify-content: center;
    }
    .r-tab-pill {
      padding: 7px 13px;
      border-radius: 99px;
      border: 1.5px solid var(--border);
      background: var(--card);
      color: var(--muted);
      font-family: 'Nunito', sans-serif;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      white-space: nowrap;
      transition: all .25s;
    }
    .r-tab-pill.active {
      background: linear-gradient(135deg, var(--accent2), var(--accent));
      border-color: transparent;
      color: #fff;
      box-shadow: 0 4px 18px rgba(247,37,133,.35);
    }
    /* slide track */
    .r-slides-outer {
      flex: 1;
      overflow: hidden;
      position: relative;
      margin-top: 10px;
    }
    .r-slides-track {
      display: flex;
      height: 100%;
      transition: transform .36s cubic-bezier(.4,0,.2,1);
    }
    .r-slide {
      min-width: 100%;
      height: 100%;
      overflow-y: auto;
      padding: 4px 16px 100px;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,.08) transparent;
    }
    .r-slide::-webkit-scrollbar { width: 3px; }
    .r-slide::-webkit-scrollbar-thumb { background: rgba(255,255,255,.1); border-radius: 99px; }
    /* rule cards inside rules screen */
    .r-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 10px;
      position: relative;
      overflow: hidden;
      animation: slideUp .35s ease both;
    }
    .r-card::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0; height: 2px;
      background: linear-gradient(90deg, var(--accent2), var(--accent), var(--neon));
      opacity: 0; transition: opacity .3s;
    }
    .r-card:hover::before { opacity: 1; }
    .r-card-icon { font-size: 26px; margin-bottom: 8px; display: block; }
    .r-card-title {
      font-family: 'Fredoka One', cursive;
      font-size: 15px;
      color: var(--text);
      margin-bottom: 7px;
    }
    .r-card-body { font-size: 13px; color: var(--muted); line-height: 1.7; }
    .r-card-body strong { color: var(--text); font-weight: 700; }
    /* hero card */
    .r-hero-card {
      background: linear-gradient(135deg, rgba(114,9,183,.25), rgba(247,37,133,.2));
      border: 1px solid rgba(247,37,133,.25);
      border-radius: 16px;
      padding: 20px 16px;
      margin-bottom: 10px;
      text-align: center;
    }
    .r-hero-emoji { font-size: 44px; margin-bottom: 8px; }
    .r-hero-title {
      font-family: 'Fredoka One', cursive;
      font-size: 20px;
      background: linear-gradient(135deg,#fff,var(--accent));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      margin-bottom: 5px;
    }
    .r-hero-sub { font-size: 12.5px; color: var(--muted); line-height: 1.6; }
    /* steps */
    .r-steps { display: flex; flex-direction: column; gap: 9px; margin-top: 4px; }
    .r-step { display: flex; align-items: flex-start; gap: 10px; }
    .r-step-num {
      width: 24px; height: 24px; border-radius: 50%; flex-shrink: 0;
      background: linear-gradient(135deg, var(--accent2), var(--accent));
      font-family: 'Fredoka One', cursive;
      font-size: 12px; display: flex; align-items: center; justify-content: center; color: #fff;
    }
    .r-step-text { font-size: 13px; color: var(--muted); line-height: 1.6; padding-top: 2px; }
    .r-step-text strong { color: var(--text); }
    /* score rows */
    .r-score-rows { display: flex; flex-direction: column; gap: 7px; margin-top: 4px; }
    .r-score-row {
      display: flex; align-items: center; justify-content: space-between;
      background: rgba(255,255,255,.03); border: 1px solid var(--border);
      border-radius: 10px; padding: 9px 12px; gap: 10px;
    }
    .r-score-left { display: flex; align-items: center; gap: 9px; font-size: 13px; color: var(--muted); }
    .r-score-left .ico { font-size: 17px; }
    .r-score-pts { font-family: 'Fredoka One', cursive; font-size: 14px; white-space: nowrap; }
    /* hints timeline */
    .r-timeline { position: relative; padding-left: 20px; margin-top: 4px; }
    .r-timeline::before {
      content: ''; position: absolute; left: 5px; top: 5px; bottom: 5px; width: 2px;
      background: linear-gradient(to bottom, var(--accent2), var(--neon)); border-radius: 99px;
    }
    .r-t-item { position: relative; margin-bottom: 14px; }
    .r-t-item:last-child { margin-bottom: 0; }
    .r-t-dot {
      position: absolute; left: -17px; top: 2px;
      width: 9px; height: 9px; border-radius: 50%;
      border: 2px solid var(--neon); background: var(--bg);
    }
    .r-t-time { font-family: 'Fredoka One', cursive; font-size: 10px; color: var(--neon); text-transform: uppercase; letter-spacing: .5px; margin-bottom: 2px; }
    .r-t-label { font-size: 13px; color: var(--muted); line-height: 1.5; }
    .r-t-label strong { color: var(--text); }
    /* hearts */
    .r-hearts-row { display: flex; gap: 5px; margin: 8px 0 3px; }
    .r-heart-pip { width: 32px; height: 32px; border-radius: 9px; display: flex; align-items: center; justify-content: center; font-size: 17px; }
    .r-heart-pip.alive { background: rgba(247,37,133,.15); border: 1.5px solid rgba(247,37,133,.4); }
    .r-heart-pip.dead  { background: rgba(255,255,255,.04); border: 1.5px solid var(--border); opacity: .35; }
    /* warn box */
    .r-warn-box {
      background: rgba(239,35,60,.08); border: 1.5px solid rgba(239,35,60,.3);
      border-radius: 11px; padding: 11px 13px; margin-top: 7px;
      font-size: 12.5px; color: #ff8fa3; line-height: 1.6;
      display: flex; gap: 9px; align-items: flex-start;
    }
    .r-warn-ico { font-size: 17px; flex-shrink: 0; margin-top: 1px; }
    /* mvp grid */
    .r-mvp-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 7px; margin-top: 4px; }
    .r-mvp-item { background: rgba(255,255,255,.03); border: 1px solid var(--border); border-radius: 11px; padding: 11px; text-align: center; }
    .r-mvp-ico { font-size: 22px; margin-bottom: 3px; }
    .r-mvp-label { font-size: 11px; color: var(--muted); line-height: 1.4; }
    .r-mvp-label strong { display: block; font-size: 12px; color: var(--text); margin-bottom: 1px; }
    /* tag */
    .r-tag {
      display: inline-block;
      background: rgba(76,201,240,.12); border: 1px solid rgba(76,201,240,.3);
      color: var(--neon); font-size: 10px; font-weight: 700;
      padding: 2px 7px; border-radius: 99px; margin-bottom: 7px;
    }
    /* nav dots */
    .r-dots { display: flex; justify-content: center; gap: 5px; padding: 8px 0 6px; flex-shrink: 0; }
    .r-dot { width: 6px; height: 6px; border-radius: 99px; background: var(--border); transition: all .3s; cursor: pointer; }
    .r-dot.active { width: 18px; background: var(--accent); }
    .r-swipe { text-align: center; font-size: 10px; color: var(--muted); padding-bottom: 3px; flex-shrink: 0; opacity: .55; }
    /* start button fixed at bottom */
    .r-start-wrap {
      position: absolute;
      bottom: 0; left: 0; right: 0;
      padding: 10px 16px 16px;
      background: linear-gradient(to top, var(--bg) 70%, transparent);
      pointer-events: none;
    }
    .r-start-btn {
      width: 100%;
      padding: 15px;
      border-radius: 14px;
      border: none;
      font-family: 'Fredoka One', cursive;
      font-size: 19px;
      background: linear-gradient(135deg, var(--green), #048a68);
      color: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 6px 24px rgba(6,214,160,.35);
      transition: transform .2s, box-shadow .2s;
      pointer-events: all;
    }
    .r-start-btn:active { transform: scale(.97); box-shadow: 0 2px 10px rgba(6,214,160,.2); }

    /* ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ */
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(13, 13, 26, .9);
      z-index: 400;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 14px
    }

    .loading-overlay.hidden {
      display: none
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(76, 201, 240, .2);
      border-top-color: var(--neon);
      border-radius: 50%;
      animation: spin 0.8s linear infinite
    }

    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }

    .loading-text {
      color: var(--neon);
      font-family: 'Fredoka One', cursive;
      font-size: 16px
    }
  </style>
</head>

<body>

  <!-- LOADING OVERLAY -->
  <div class="loading-overlay" id="loading-overlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Connecting to Firebase‚Ä¶</div>
  </div>

  <!-- TAB BAR -->
  <div class="tab-bar">
    <button class="tab-btn active" onclick="switchTab('host')" id="tab-host">üéØ Host</button>
    <button class="tab-btn" onclick="switchTab('player')" id="tab-player">üïπÔ∏è Player</button>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <!-- NOTIFICATION BAR (host rejoin alerts) -->
  <div class="notif-bar" id="notif-bar"></div>

  <!-- ABORT SCREEN -->
  <div class="abort-screen" id="abort-screen">
    <div class="abort-emoji">üö´</div>
    <h2>Session Aborted!</h2>
    <p>You left the game tab.<br>Your session has been paused.</p>
    <button class="rejoin-btn" id="rejoin-btn" onclick="requestRejoin()" style="display:none">üîÑ Request to
      Rejoin</button>
    <div class="rejoin-status" id="rejoin-status"></div>
  </div>

  <!-- MODAL -->
  <div class="modal-overlay" id="modal">
    <div class="modal">
      <h2 id="modal-title">‚ö†Ô∏è Confirm</h2>
      <p id="modal-body">Are you sure?</p>
      <button class="btn btn-danger" onclick="modalConfirm()">Yes, proceed</button>
      <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê HOST: LOGIN ‚ïê‚ïê‚ïê -->
  <div class="screen active" id="host-login">
    <div class="hero">
      <h1>CONNEXiON üéÆ</h1>
      <p>Real multiplayer ‚Äî students on their own PCs!</p>
    </div>

    <div class="card">
      <div class="card-title">üîê Host Login</div>
      <input type="text" id="host-username" placeholder="Username" />
      <div style="position:relative;margin-bottom:12px">
        <input type="password" id="host-password" placeholder="Password" style="margin-bottom:0;padding-right:48px" />
        <button onclick="togglePwd()" id="pwd-eye"
          style="position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;font-size:20px;color:var(--muted);padding:0;line-height:1">üëÅÔ∏è</button>
      </div>
      <button class="btn btn-primary" onclick="hostLogin()">üöÄ Login & Create Room</button>
    </div>
    <div class="card" style="font-size:13px;color:var(--muted);line-height:1.8">
      <div class="card-title" style="font-size:15px">üìã How It Works</div>
      1. Login and create a room<br>
      2. Share the room code with your students<br>
      3. Students open this page on their PC ‚Üí Player tab<br>
      4. Monitor scores, answers & status live<br>
      5. End game anytime or let all 80 questions run
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê HOST: LOBBY ‚ïê‚ïê‚ïê -->
  <div class="screen" id="host-lobby">
    <div class="room-code-display">
      <div class="label">Room Code</div>
      <div class="code" id="host-room-code">----</div>
      <div class="sub">Students enter this code in the Player tab</div>
    </div>
    <div class="card">
      <div class="card-title">üë• Players Joined</div>
      <div id="lobby-player-list">
        <div class="empty"><span class="icon">‚è≥</span>Waiting for players‚Ä¶</div>
      </div>
    </div>
    <button class="btn btn-success" id="start-game-btn" onclick="hostStartGame()" disabled>‚ñ∂Ô∏è Start Game</button>
    <button class="btn btn-danger" onclick="confirmTerminate()">üóëÔ∏è Terminate Room</button>
  </div>

  <!-- ‚ïê‚ïê‚ïê HOST: DASHBOARD ‚ïê‚ïê‚ïê -->
  <div class="screen" id="host-dashboard">
    <div class="pill-row">
      <div class="pill">Q <span id="hd-q-num">1</span>/80</div>
      <div class="pill">Players <span id="hd-player-count">0</span></div>
      <div class="pill">‚è±Ô∏è <span id="hd-timer">30</span>s</div>
    </div>
    <div class="card" style="padding:14px">
      <div class="q-number" id="hd-q-label">Question 1 of 80</div>
      <div class="clue-chips" id="hd-clue-chips"></div>
      <div class="host-answer-box">
        <span class="ans-label">Answer</span>
        <span class="ans-word" id="hd-answer">‚Äî</span>
      </div>
      <div id="hd-hint-badge" class="host-hint-badge" style="display:none">
        üí° <span id="hd-hint-text"></span>
      </div>
    </div>
    <div class="dash-tabs">
      <button class="dash-tab active" onclick="showDashTab('scores',event)">üèÜ Scores</button>
      <button class="dash-tab" onclick="showDashTab('answers',event)">üí¨ Answers</button>
      <button class="dash-tab" onclick="showDashTab('players',event)">üë• Players</button>
    </div>
    <div id="dash-scores" class="dash-panel">
      <div class="card" style="padding:14px" id="scores-list"></div>
    </div>
    <div id="dash-answers" class="dash-panel" style="display:none">
      <div class="card" style="padding:14px" id="answers-list"></div>
    </div>
    <div id="dash-players" class="dash-panel" style="display:none">
      <div class="card" style="padding:0 14px" id="players-list"></div>
    </div>
    <div style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
      <button class="btn btn-secondary" style="font-size:16px" onclick="hostForceNext()">‚è≠Ô∏è Force Next Question</button>
      <button class="end-game-btn" onclick="confirmEndGame()">üèÅ End Game & See Results</button>
      <button class="btn btn-danger" onclick="confirmTerminate()">üóëÔ∏è Terminate Room</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê HOST: FINAL DASHBOARD ‚ïê‚ïê‚ïê -->
  <div class="screen" id="host-gameover">
    <div class="hero" style="padding-bottom:6px">
      <h1>üèÅ Final Results</h1>
      <p id="host-go-sub">Game completed</p>
    </div>
    <div class="card" style="padding:14px">
      <div class="card-title">üèÜ Podium</div>
      <div class="podium" id="host-podium"></div>
    </div>
    <div class="dash-tabs">
      <button class="dash-tab active" onclick="showFinalTab('scoreboard',event)">üìä Scoreboard</button>
      <button class="dash-tab" onclick="showFinalTab('performance',event)">üìà Performance</button>
      <button class="dash-tab" onclick="showFinalTab('mvp',event)">‚≠ê MVPs</button>
    </div>
    <div id="final-scoreboard" class="final-panel">
      <div class="card" style="padding:14px" id="host-final-scores"></div>
    </div>
    <div id="final-performance" class="final-panel" style="display:none">
      <div class="card" style="padding:14px" id="host-final-perf"></div>
    </div>
    <div id="final-mvp" class="final-panel" style="display:none">
      <div id="host-final-mvp" style="padding-bottom:4px"></div>
    </div>
    <button class="btn btn-primary" onclick="hostNewGame()" style="margin-top:8px">üîÑ New Room</button>
    <button class="btn btn-danger" onclick="confirmTerminate()">üóëÔ∏è Exit</button>
  </div>

  <!-- ‚ïê‚ïê‚ïê PLAYER: JOIN ‚ïê‚ïê‚ïê -->
  <div class="screen" id="player-join">
    <div class="hero">
      <h1>CONNEXiON üéÆ</h1>
      <p>Join your HOST's room to play!</p>
    </div>

    <div class="card">
      <div class="card-title">üïπÔ∏è Join a Room</div>
      <input type="text" id="player-name" placeholder="Your name" maxlength="20" />
      <input type="text" id="player-room-code" placeholder="Room code from HOST" style="text-transform:uppercase" />
      <button class="btn btn-secondary" onclick="playerJoin()">üéÆ Join & Play!</button>
    </div>
    <div class="card" style="font-size:13px;color:var(--muted);line-height:1.9">
      <div class="card-title" style="font-size:15px">üìñ Game Rules</div>
      ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è 3 chances per question<br>
      ‚è±Ô∏è <strong style="color:var(--yellow)">30 seconds</strong> to answer each puzzle<br>
      ‚úÖ Correct answer earns points + ‚ö° Speed bonus for fast answers<br>
      ‚ùå Wrong guess = lose 1 chance<br>
      üíî Lose ALL chances = <strong style="color:var(--red)">score deduction!</strong><br>
      üö´ Leaving tab = session aborted!<br>
      üí° Hints unlock as time runs out<br>
      üèÜ <strong style="color:var(--neon)">Scores &amp; ranks shown on host screen only</strong>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê PLAYER: RULES ‚ïê‚ïê‚ïê -->
  <div class="screen" id="player-rules">
    <!-- Header -->
    <div class="rules-header">
      <h2>CONNEXiON üéÆ ‚Äî How to Play</h2>
      <p>Read the rules, then click <strong style="color:var(--green)">Let's Play!</strong> to enter the lobby</p>
    </div>

    <!-- Tab pills -->
    <div class="r-tab-wrap">
      <div class="r-tab-strip" id="rTabStrip">
        <button class="r-tab-pill active"  onclick="rGoTo(0)">üéØ Overview</button>
        <button class="r-tab-pill"         onclick="rGoTo(1)">üïπÔ∏è Joining</button>
        <button class="r-tab-pill"         onclick="rGoTo(2)">‚è±Ô∏è Gameplay</button>
        <button class="r-tab-pill"         onclick="rGoTo(3)">üèÜ Scoring</button>
        <button class="r-tab-pill"         onclick="rGoTo(4)">üèÅ End Game</button>
      </div>
    </div>

    <!-- Slides -->
    <div class="r-slides-outer" id="rSlidesOuter">
      <div class="r-slides-track" id="rSlidesTrack">

        <!-- SLIDE 0: OVERVIEW -->
        <div class="r-slide">
          <div class="r-hero-card">
            <div class="r-hero-emoji">üß©</div>
            <div class="r-hero-title">What is CONNEXiON?</div>
            <div class="r-hero-sub">A live multiplayer emoji word game. Look at the emoji clues and guess the compound word they form ‚Äî before time runs out!</div>
          </div>
          <div class="r-card">
            <span class="r-card-icon">üëÄ</span>
            <div class="r-card-title">The Concept</div>
            <div class="r-card-body">
              Each round shows <strong>2 emojis</strong> whose names join syllabically to make a word.<br><br>
              Example: <strong>‚òÄÔ∏è SUN + üåÖ SET = SUNSET</strong> &nbsp;|&nbsp; <strong>‚õèÔ∏è MINE + üèóÔ∏è CRAFT = MINECRAFT</strong>
            </div>
          </div>
          <div class="r-card">
            <span class="r-card-icon">üì±</span>
            <div class="r-card-title">What You Need</div>
            <div class="r-card-body">
              <strong>Students:</strong> Any PC or laptop with a browser ‚Äî no installation needed.<br><br>
              <strong>Teacher/Host:</strong> One device to host and monitor the live dashboard.
            </div>
          </div>
          <div class="r-card">
            <span class="r-card-icon">üî¢</span>
            <div class="r-card-title">Game Structure</div>
            <div class="r-card-body">
              <strong>80 questions</strong> per game &bull; Each has a <strong>30-second timer</strong> &bull; <strong>3 chances</strong> per question &bull; Host can skip or end anytime.
            </div>
          </div>
        </div>

        <!-- SLIDE 1: JOINING -->
        <div class="r-slide">
          <div class="r-card">
            <span class="r-tag">FOR STUDENTS</span>
            <div class="r-card-title">üïπÔ∏è How to Join</div>
            <div class="r-steps">
              <div class="r-step"><div class="r-step-num">1</div><div class="r-step-text">Open the game link and click the <strong>Player tab</strong></div></div>
              <div class="r-step"><div class="r-step-num">2</div><div class="r-step-text">Enter your <strong>name</strong> and the <strong>Room Code</strong> from your teacher</div></div>
              <div class="r-step"><div class="r-step-num">3</div><div class="r-step-text">Read these rules, then click <strong>Let's Play!</strong></div></div>
              <div class="r-step"><div class="r-step-num">4</div><div class="r-step-text">Wait in the <strong>lobby</strong> until the host starts the game</div></div>
            </div>
          </div>
          <div class="r-card">
            <span class="r-tag">FOR THE HOST</span>
            <div class="r-card-title">üéØ How to Host</div>
            <div class="r-steps">
              <div class="r-step"><div class="r-step-num">1</div><div class="r-step-text">Login with the <strong>host password</strong></div></div>
              <div class="r-step"><div class="r-step-num">2</div><div class="r-step-text">A unique <strong>Room Code</strong> is generated ‚Äî share it with students</div></div>
              <div class="r-step"><div class="r-step-num">3</div><div class="r-step-text">Wait for players to join, then click <strong>Start Game</strong></div></div>
              <div class="r-step"><div class="r-step-num">4</div><div class="r-step-text">Monitor <strong>scores, answers and player status</strong> live</div></div>
            </div>
          </div>
          <div class="r-card">
            <div class="r-warn-box">
              <div class="r-warn-ico">‚ö†Ô∏è</div>
              <div><strong>Stay on the page!</strong> Switching tabs during the game aborts your session automatically.</div>
            </div>
          </div>
        </div>

        <!-- SLIDE 2: GAMEPLAY -->
        <div class="r-slide">
          <div class="r-card">
            <span class="r-card-icon">üß©</span>
            <div class="r-card-title">Each Question</div>
            <div class="r-card-body">
              You'll see <strong>2 emojis</strong> on screen. Join their names to guess the word and type your answer. Not case-sensitive!
            </div>
          </div>
          <div class="r-card">
            <div class="r-card-title">‚ù§Ô∏è Your 3 Chances</div>
            <div class="r-card-body" style="margin-bottom:8px">Each question gives <strong>3 attempts</strong>. Wrong answers cost one heart.</div>
            <div class="r-hearts-row">
              <div class="r-heart-pip alive">‚ù§Ô∏è</div>
              <div class="r-heart-pip alive">‚ù§Ô∏è</div>
              <div class="r-heart-pip alive">‚ù§Ô∏è</div>
            </div>
            <div style="font-size:11px;color:var(--muted);margin-top:4px">All 3 chances at the start</div>
            <div class="r-hearts-row" style="margin-top:10px">
              <div class="r-heart-pip alive">‚ù§Ô∏è</div>
              <div class="r-heart-pip dead">‚ù§Ô∏è</div>
              <div class="r-heart-pip dead">‚ù§Ô∏è</div>
            </div>
            <div style="font-size:11px;color:var(--muted);margin-top:4px">After 2 wrong ‚Äî 1 chance left, final hint unlocked</div>
          </div>
          <div class="r-card">
            <div class="r-card-title">üí° Auto Hints</div>
            <div class="r-card-body" style="margin-bottom:8px">Hints unlock automatically as time runs down!</div>
            <div class="r-timeline">
              <div class="r-t-item">
                <div class="r-t-dot"></div>
                <div class="r-t-time">Start</div>
                <div class="r-t-label">üè∑Ô∏è <strong>Category hint</strong> always visible</div>
              </div>
              <div class="r-t-item">
                <div class="r-t-dot"></div>
                <div class="r-t-time">12 seconds left</div>
                <div class="r-t-label">üî§ <strong>Letter count</strong> hint unlocks</div>
              </div>
              <div class="r-t-item">
                <div class="r-t-dot"></div>
                <div class="r-t-time">5 seconds left</div>
                <div class="r-t-label">üîë <strong>First &amp; last letter</strong> hint unlocks</div>
              </div>
            </div>
          </div>
        </div>

        <!-- SLIDE 3: SCORING -->
        <div class="r-slide">
          <div class="r-card">
            <div class="r-card-title">üìä Points System</div>
            <div class="r-card-body" style="margin-bottom:10px">Points are tracked by the host and revealed at the end. Focus on answering correctly and quickly!</div>
            <div class="r-score-rows">
              <div class="r-score-row"><div class="r-score-left"><span class="ico">‚úÖ</span>Correct answer</div><div class="r-score-pts" style="color:var(--green)">Points ‚úì</div></div>
              <div class="r-score-row"><div class="r-score-left"><span class="ico">‚ö°</span>Speed bonus</div><div class="r-score-pts" style="color:var(--yellow)">Bonus ‚úì</div></div>
              <div class="r-score-row"><div class="r-score-left"><span class="ico">‚è±Ô∏è</span>Time runs out</div><div class="r-score-pts" style="color:var(--muted)">No points</div></div>
              <div class="r-score-row"><div class="r-score-left"><span class="ico">üíî</span>All 3 chances used</div><div class="r-score-pts" style="color:var(--red)">Deduction</div></div>
            </div>
          </div>
          <div class="r-card">
            <span class="r-card-icon">‚ö°</span>
            <div class="r-card-title">Speed Bonus</div>
            <div class="r-card-body">Answer quickly to earn a <strong>speed bonus</strong> on top of your correct-answer points. The faster you answer, the higher your bonus!</div>
          </div>
          <div class="r-card">
            <span class="r-card-icon">üíî</span>
            <div class="r-card-title">Deduction Warning</div>
            <div class="r-card-body">Using all <strong>3 chances</strong> without a correct answer causes a <strong>score deduction</strong>. Sometimes skipping (letting the timer run) is smarter than guessing wildly!</div>
          </div>
        </div>

        <!-- SLIDE 4: END GAME -->
        <div class="r-slide">
          <div class="r-card">
            <span class="r-card-icon">üèÅ</span>
            <div class="r-card-title">How the Game Ends</div>
            <div class="r-card-body">Ends after all <strong>80 questions</strong>, or when the host ends it early. Final results are shown to everyone simultaneously.</div>
          </div>
          <div class="r-card">
            <div class="r-card-title">ü•á Final Results</div>
            <div class="r-card-body" style="margin-bottom:10px">After the game:</div>
            <div class="r-steps">
              <div class="r-step"><div class="r-step-num">ü•á</div><div class="r-step-text"><strong>Podium</strong> ‚Äî Top 3 on a live leaderboard</div></div>
              <div class="r-step"><div class="r-step-num">üìä</div><div class="r-step-text"><strong>Full scoreboard</strong> ‚Äî Scores, correct answers & deductions</div></div>
              <div class="r-step"><div class="r-step-num">üìà</div><div class="r-step-text"><strong>Your stats</strong> ‚Äî Correct, wrong, timeouts, deductions</div></div>
            </div>
          </div>
          <div class="r-card">
            <div class="r-card-title">üåü MVP Awards</div>
            <div class="r-mvp-grid">
              <div class="r-mvp-item"><div class="r-mvp-ico">üèÜ</div><div class="r-mvp-label"><strong>Top Score</strong>Highest total points</div></div>
              <div class="r-mvp-item"><div class="r-mvp-ico">üéØ</div><div class="r-mvp-label"><strong>Most Correct</strong>Most right answers</div></div>
              <div class="r-mvp-item"><div class="r-mvp-ico">‚ö°</div><div class="r-mvp-label"><strong>Best Accuracy</strong>Highest % correct</div></div>
              <div class="r-mvp-item"><div class="r-mvp-ico">üíö</div><div class="r-mvp-label"><strong>No Deductions</strong>Perfect composure</div></div>
            </div>
          </div>
        </div>

      </div><!-- /r-slides-track -->
    </div><!-- /r-slides-outer -->

    <!-- Nav dots -->
    <div class="r-dots" id="rDots">
      <div class="r-dot active" onclick="rGoTo(0)"></div>
      <div class="r-dot" onclick="rGoTo(1)"></div>
      <div class="r-dot" onclick="rGoTo(2)"></div>
      <div class="r-dot" onclick="rGoTo(3)"></div>
      <div class="r-dot" onclick="rGoTo(4)"></div>
    </div>
    <div class="r-swipe">Click tabs or use arrow keys to navigate</div>

    <!-- Fixed start button -->
    <div class="r-start-wrap">
      <button class="r-start-btn" onclick="rulesStart()">üéÆ Let's Play!</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê PLAYER: WAITING ‚ïê‚ïê‚ïê -->
  <div class="screen" id="player-waiting">
    <div class="card" style="text-align:center;padding:32px 20px">
      <div style="font-size:56px;margin-bottom:12px;animation:pulse 1.5s infinite">‚è≥</div>
      <div style="font-family:'Fredoka One',cursive;font-size:22px;color:var(--neon)" id="pw-name">Hello!</div>
      <div style="color:var(--muted);margin-top:8px;font-size:14px">Waiting for host to start the game‚Ä¶</div>
      <div style="margin-top:16px;font-size:13px;color:var(--muted)">Room: <span id="pw-room"
          style="color:var(--yellow);font-weight:700">‚Äî</span></div>
    </div>
    <div class="card">
      <div class="card-title">üë• Players in Room</div>
      <div id="pw-player-list">
        <div class="empty"><span class="icon">‚åõ</span>Loading‚Ä¶</div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê PLAYER: GAME ‚ïê‚ïê‚ïê -->
  <div class="screen" id="player-game">
    <div class="q-progress">
      <div class="label" id="pg-q-label">Q 1/80</div>
      <div class="progress-bar">
        <div class="progress-fill" id="pg-progress" style="width:1%"></div>
      </div>
    </div>
    <div class="solved-bar">
      <div class="solved-text">‚úÖ Solved</div>
      <div class="solved-count" id="pg-solved-count">0 / 80</div>
    </div>
    <div class="timer-ring-wrap">
      <svg class="timer-svg" width="86" height="86" viewBox="0 0 86 86">
        <circle class="timer-bg" cx="43" cy="43" r="36" />
        <circle class="timer-arc" id="timer-arc" cx="43" cy="43" r="36" stroke-dasharray="226.19"
          stroke-dashoffset="0" />
        <text class="timer-text" x="43" y="43" id="timer-text">30</text>
      </svg>
    </div>
    <div class="chances" id="chances-display">
      <span class="heart">‚ù§Ô∏è</span><span class="heart">‚ù§Ô∏è</span><span class="heart">‚ù§Ô∏è</span>
    </div>
    <div id="game-card" class="card" style="padding:14px">
      <div class="q-number" id="pg-q-number">QUESTION 1 OF 80</div>
      <div class="clue-chips" id="pg-clue-chips"></div>
      <div class="hint-box">
        <div class="hint-row unlocked" id="hint-row-0">
          <span class="hint-icon">üè∑Ô∏è</span>
          <span class="hint-label">Category</span>
          <span class="hint-value" id="hint-0">‚Äî</span>
        </div>
        <div class="hint-row locked" id="hint-row-1">
          <span class="hint-icon">üî§</span>
          <span class="hint-label">Letters</span>
          <span class="hint-value masked" id="hint-1">_ _ _</span>
        </div>
        <div class="hint-row locked" id="hint-row-2">
          <span class="hint-icon">üîë</span>
          <span class="hint-label">First + Last</span>
          <span class="hint-value masked" id="hint-2">? ‚Ä¶ ?</span>
        </div>
      </div>
      <div id="answer-section">
        <div class="answer-area">
          <input type="text" id="player-answer" placeholder="Type your answer‚Ä¶" autocomplete="off" autocorrect="off"
            spellcheck="false" style="margin-bottom:0" />
          <button onclick="submitAnswer()">‚Ü©</button>
        </div>
        <button class="btn btn-primary" style="margin-top:10px" onclick="submitAnswer()">Submit Answer</button>
      </div>
      <div id="result-section" style="display:none"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê PLAYER: GAME OVER ‚ïê‚ïê‚ïê -->
  <div class="screen" id="player-gameover">
    <div class="hero" style="padding-bottom:16px">
      <h1>üèÅ Game Over!</h1>
      <p id="final-rank-msg">Great game ‚Äî check the host screen for results!</p>
    </div>
    <div class="card" style="text-align:center;padding:24px">
      <div style="font-size:52px;margin-bottom:10px" id="go-emoji">üéâ</div>
      <div style="font-family:'Fredoka One',cursive;font-size:22px;color:var(--neon)">Well Played!</div>
      <div style="color:var(--muted);font-size:13px;margin-top:8px;line-height:1.6">
        Scores &amp; rankings are revealed<br>on the <strong style="color:var(--yellow)">host's screen</strong> üèÜ
      </div>
    </div>
    <div class="card" style="padding:14px">
      <div class="card-title">üìä Your Stats</div>
      <div id="go-stats"></div>
    </div>
    <button class="btn btn-outline" onclick="playerGoHome()">üè† Back to Join</button>
  </div>

  <script>
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // 80 SYLLABIC EMOJI WORD PUZZLES
    // Each puzzle shows 2 emoji chips ‚Äî join their names to get the answer.
    // e.g. ‚òÄÔ∏è(SUN) + ‚ú®(SHINE) = SUNSHINE
    // Categories: Easy compounds ¬∑ Medium ¬∑ üéÆ Games ¬∑ üé¨ Tamil Cinema
    const PUZZLES = [

      // ‚ïê‚ïê EASY COMPOUND WORDS ‚ïê‚ïê (simple 2-part compound words)
      { images: ['sun','set'],       answer: 'SUNSET',      hint: 'End of the day sky' },
      { images: ['star','fish'],     answer: 'STARFISH',    hint: '5-armed ocean creature' },
      { images: ['moon','light'],    answer: 'MOONLIGHT',   hint: 'Night sky glow' },
      { images: ['bee','hive'],      answer: 'BEEHIVE',     hint: 'Honeybee home' },
      { images: ['rain','bow'],      answer: 'RAINBOW',     hint: 'Colourful arc after rain' },
      { images: ['butter','fly'],    answer: 'BUTTERFLY',   hint: 'Winged nectar seeker' },
      { images: ['book','mark'],     answer: 'BOOKMARK',    hint: 'Page saver' },
      { images: ['water','melon'],   answer: 'WATERMELON',  hint: 'Summer green fruit' },
      { images: ['key','board'],     answer: 'KEYBOARD',    hint: 'Type on this device' },
      { images: ['sun','flower'],    answer: 'SUNFLOWER',   hint: 'Tall yellow bloom' },
      { images: ['pan','cake'],      answer: 'PANCAKE',     hint: 'Breakfast stack with syrup' },
      { images: ['birth','day'],     answer: 'BIRTHDAY',    hint: 'Annual celebration' },
      { images: ['gold','fish'],     answer: 'GOLDFISH',    hint: 'Orange bowl pet' },
      { images: ['fire','fly'],      answer: 'FIREFLY',     hint: 'Glowing night insect' },
      { images: ['bed','room'],      answer: 'BEDROOM',     hint: 'Sleep space' },
      { images: ['sun','glasses'],   answer: 'SUNGLASSES',  hint: 'UV eye protection' },
      { images: ['rose','bud'],      answer: 'ROSEBUD',     hint: 'Unopened flower' },
      { images: ['dragon','fly'],    answer: 'DRAGONFLY',   hint: 'Hovering water insect' },
      { images: ['sea','shell'],     answer: 'SEASHELL',    hint: 'Beach treasure' },
      { images: ['door','step'],     answer: 'DOORSTEP',    hint: 'Entrance threshold' },
      { images: ['hot','dog'],       answer: 'HOTDOG',      hint: 'Sausage in a bun' },
      { images: ['cheese','cake'],   answer: 'CHEESECAKE',  hint: 'Creamy baked dessert' },
      { images: ['spring','time'],   answer: 'SPRINGTIME',  hint: 'Blooming warm season' },
      { images: ['eye','lid'],       answer: 'EYELID',      hint: 'Blink cover' },
      { images: ['ham','bird'],      answer: 'HUMMINGBIRD', hint: 'Tiny hovering bird ‚Äî hum + ming' },

      // ‚ïê‚ïê MEDIUM COMPOUND WORDS ‚ïê‚ïê
      { images: ['thunder','bolt'],  answer: 'THUNDERBOLT',    hint: 'Zeus\'s weapon' },
      { images: ['fire','wall'],     answer: 'FIREWALL',       hint: 'Network security barrier' },
      { images: ['wild','card'],     answer: 'WILDCARD',       hint: 'Unpredictable player' },
      { images: ['under','world'],   answer: 'UNDERWORLD',     hint: 'Criminal realm' },
      { images: ['super','hero'],    answer: 'SUPERHERO',      hint: 'Caped crimefighter' },
      { images: ['gem','stone'],     answer: 'GEMSTONE',       hint: 'Precious mineral' },
      { images: ['lion','heart'],    answer: 'LIONHEART',      hint: 'Extremely brave person' },
      { images: ['sword','fish'],    answer: 'SWORDFISH',      hint: 'Long-billed ocean fish' },
      { images: ['sweet','heart'],   answer: 'SWEETHEART',     hint: 'Beloved one' },
      { images: ['back','stage'],    answer: 'BACKSTAGE',      hint: 'Behind the curtain' },
      { images: ['dark','horse'],    answer: 'DARK HORSE',     hint: 'Surprise competitor' },
      { images: ['black','board'],   answer: 'BLACKBOARD',     hint: 'Chalk-writing surface' },
      { images: ['ice','break'],     answer: 'ICEBREAKER',     hint: 'Conversation starter' },
      { images: ['moon','shine'],    answer: 'MOONSHINE',      hint: 'Illicit spirit or lunar glow' },
      { images: ['over','night'],    answer: 'OVERNIGHT',      hint: 'All through the night' },
      { images: ['blood','hound'],   answer: 'BLOODHOUND',     hint: 'Keen-scented tracker dog' },
      { images: ['thunder','struck'],answer: 'THUNDERSTRUCK',  hint: 'Deeply astonished' },
      { images: ['head','shot'],     answer: 'HEADSHOT',       hint: 'Portrait or sniper hit' },
      { images: ['check','point'],   answer: 'CHECKPOINT',     hint: 'Save or verify spot' },
      { images: ['shadow','box'],    answer: 'SHADOWBOX',      hint: 'Solo fight practice' },
      { images: ['crystal','ball'],  answer: 'CRYSTAL BALL',   hint: 'Fortune teller\'s orb' },
      { images: ['ghost','writer'],  answer: 'GHOSTWRITER',    hint: 'Unnamed author' },
      { images: ['under','current'], answer: 'UNDERCURRENT',   hint: 'Hidden flow or influence' },
      { images: ['fire','stone'],    answer: 'FIRESTONE',      hint: 'Sparking hard mineral' },
      { images: ['diamond','back'],  answer: 'DIAMONDBACK',    hint: 'Patterned rattlesnake' },

      // ‚ïê‚ïê üéÆ GAMES THEMED ‚ïê‚ïê
      { images: ['mine','craft'],    answer: 'MINECRAFT',     hint: '‚õèÔ∏è Block-building sandbox game' },
      { images: ['fort','night'],    answer: 'FORTNITE',      hint: 'üéÆ Battle royale island game' },
      { images: ['game','play'],     answer: 'GAMEPLAY',      hint: 'How a video game plays' },
      { images: ['war','craft'],     answer: 'WARCRAFT',      hint: 'üßù Blizzard medieval strategy' },
      { images: ['star','craft'],    answer: 'STARCRAFT',     hint: 'üöÄ Blizzard space RTS' },
      { images: ['dead','shot'],     answer: 'DEADSHOT',      hint: 'üéØ Perfect-aim DC villain' },
      { images: ['night','fall'],    answer: 'NIGHTFALL',     hint: 'Destiny 2 strike mode' },
      { images: ['ghost','ship'],    answer: 'GHOST SHIP',    hint: 'üëª Abandoned vessel mystery' },
      { images: ['speed','run'],     answer: 'SPEEDRUN',      hint: 'üèÉ Fastest game completion race' },
      { images: ['power','up'],      answer: 'POWER UP',      hint: '‚≠ê Collectible boost in games' },
      { images: ['battle','field'],  answer: 'BATTLEFIELD',   hint: 'üí• EA military shooter series' },
      { images: ['over','watch'],    answer: 'OVERWATCH',     hint: 'üéØ Blizzard team hero shooter' },
      { images: ['skull','cap'],     answer: 'SKULLCAP',      hint: 'Close-fitting head cover' },
      { images: ['dragon','ball'],   answer: 'DRAGONBALL',    hint: 'üêâ Goku\'s anime quest' },
      { images: ['head','band'],     answer: 'HEADBAND',      hint: 'Elastic hair accessory' },
      { images: ['fire','arms'],     answer: 'FIREARMS',      hint: 'Guns and weapons' },
      { images: ['thunder','head'],  answer: 'THUNDERHEAD',   hint: 'Towering storm cloud' },
      { images: ['blood','stone'],   answer: 'BLOODSTONE',    hint: 'Dark green gemstone' },
      { images: ['over','lord'],     answer: 'OVERLORD',      hint: 'Supreme commander or ruler' },
      { images: ['shadow','play'],   answer: 'SHADOWPLAY',    hint: 'Theatre with silhouettes' },

      // ‚ïê‚ïê üé¨ TAMIL CINEMA THEMED ‚ïê‚ïê
      { images: ['super','star'],    answer: 'SUPERSTAR',     hint: 'üåü Rajinikanth\'s iconic title' },
      { images: ['mind','beast'],    answer: 'MINDBEAST',     hint: 'üß† Wild intellect ‚Äî Vijay\'s BEAST' },
      { images: ['king','maker'],    answer: 'KINGMAKER',     hint: 'üëë Kollywood political drama role' },
      { images: ['war','lord'],      answer: 'WARLORD',       hint: '‚öîÔ∏è Tamil action military ruler' },
      { images: ['fire','brand'],    answer: 'FIREBRAND',     hint: 'üî• Passionate rebel hero' },
      { images: ['silver','screen'], answer: 'SILVERSCREEN',  hint: 'üé¨ Tamil cinema world' },
      { images: ['storm','rider'],   answer: 'STORM RIDER',   hint: 'üå™Ô∏è Fast-action stunt hero' },
      { images: ['night','rider'],   answer: 'NIGHT RIDER',   hint: 'üåô Nocturnal action hero' },
      { images: ['golden','age'],    answer: 'GOLDEN AGE',    hint: '‚ú® Kollywood\'s peak classic era' },
      { images: ['black','lion'],    answer: 'BLACK LION',    hint: 'ü¶Å Leo / dark fierce hero symbol' },
      { images: ['high','land'],     answer: 'HIGHLAND',      hint: 'üèîÔ∏è Kaithi rugged terrain chase' },
      { images: ['action','hero'],   answer: 'ACTION HERO',   hint: 'üé¨ Tamil mass entertainer lead' },
      { images: ['tiger','king'],    answer: 'TIGER KING',    hint: 'üêÖ Fierce royal Tamil villain' },
      { images: ['sword','play'],    answer: 'SWORDPLAY',     hint: 'üó°Ô∏è Classic Tamil period-drama duel' },
      { images: ['star','light'],    answer: 'STARLIGHT',     hint: '‚≠ê Kollywood glamour glow' },

      // ‚ïê‚ïê IDIOM & PHRASE COMPOUNDS ‚ïê‚ïê
      { images: ['eye','witness'],   answer: 'EYEWITNESS',    hint: 'Person who saw the event' },
      { images: ['brain','wash'],    answer: 'BRAINWASH',     hint: 'Forcefully change beliefs' },
      { images: ['cold','blood'],    answer: 'COLDBLOODED',   hint: 'Emotionless or reptilian' },
      { images: ['paper','trail'],   answer: 'PAPERTRAIL',    hint: 'Documented evidence path' },
      { images: ['blind','spot'],    answer: 'BLINDSPOT',     hint: 'Area you fail to notice' },
      { images: ['chain','reaction'],answer: 'CHAINREACTION', hint: 'Events triggering one another' },
      { images: ['double','edge'],   answer: 'DOUBLEEDGE',    hint: 'Both helpful and harmful' },
      { images: ['silent','storm'],  answer: 'SILENTSTORM',   hint: 'Hidden emotional turmoil' },
      { images: ['false','alarm'],   answer: 'FALSEALARM',    hint: 'Warning without danger' },
      { images: ['deep','freeze'],   answer: 'DEEPFREEZE',    hint: 'Extreme cold storage' },
      { images: ['memory','lane'],   answer: 'MEMORYLANE',    hint: 'Nostalgic recollection' },
      { images: ['last','stand'],    answer: 'LASTSTAND',     hint: 'Final defensive effort' },
      { images: ['heavy','heart'],   answer: 'HEAVYHEART',    hint: 'Feeling deep sadness' },
      { images: ['open','secret'],   answer: 'OPENSECRET',    hint: 'Known but unspoken truth' },
      { images: ['silver','lining'], answer: 'SILVERLINING',  hint: 'Positive side of bad situation' },

      // ‚ïê‚ïê FUNCTION-WORD COMPOUNDS ‚ïê‚ïê
      { images: ['after','shock'],   answer: 'AFTERSHOCK',   hint: 'Tremor following an earthquake' },
      { images: ['over','board'],    answer: 'OVERBOARD',    hint: 'Excessively or into the sea' },
      { images: ['under','take'],    answer: 'UNDERTAKE',    hint: 'To begin or commit to a task' },
      { images: ['every','where'],   answer: 'EVERYWHERE',   hint: 'All places at once' },
      { images: ['some','thing'],    answer: 'SOMETHING',    hint: 'An unknown object or idea' },
      { images: ['any','where'],     answer: 'ANYWHERE',     hint: 'No specific place' },
      { images: ['there','fore'],    answer: 'THEREFORE',    hint: 'For that reason' },
      { images: ['more','over'],     answer: 'MOREOVER',     hint: 'In addition to that' },
      { images: ['never','mind'],    answer: 'NEVERMIND',    hint: 'Ignore or forget it' },
      { images: ['with','out'],      answer: 'WITHOUT',      hint: 'Lacking something' },
      { images: ['over','take'],     answer: 'OVERTAKE',     hint: 'Catch up and pass' },
      { images: ['water','side'],    answer: 'WATERSIDE',    hint: 'Area near a body of water' },
      { images: ['after','life'],    answer: 'AFTERLIFE',    hint: 'Life beyond death belief' },
      { images: ['under','line'],    answer: 'UNDERLINE',    hint: 'Draw a line beneath text' },
    ];

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // CONSTANTS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const HOST_PASS = 'Welcome@123';
    const TIMER_MAX = 30;
    const HINT2_AT = 12;
    const HINT3_AT = 5;
    const DEDUCT_PTS = 5;

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // STATE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let currentTab = 'host';
    let db = null;       // Firebase Database instance
    let roomRef = null;       // ref to /rooms/{roomCode}
    let myListeners = [];         // active Firebase listeners to clean up
    let roomCode = null;       // current room code
    let playerState = null;
    let gameTimer = null;
    let timerSeconds = TIMER_MAX;
    let playerAborted = false;
    let playerTimerInterval = null;
    let playerTimerSecs = TIMER_MAX;
    let autoNextTimer = null;
    let modalAction = null;
    let hostQuestions = null;       // host keeps questions in memory
    let localPlayers = {};         // host's local mirror of players
    let localCurrentQ = 0;
    let localStatus = 'lobby';

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // FIREBASE SETUP ‚Äî hardcoded URL
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const FIREBASE_URL = 'https://conn-e-xion-default-rtdb.firebaseio.com/';

    function initFirebase(databaseURL) {
      const url = databaseURL.trim().replace(/\/$/, '');

      if (firebase.apps.length > 0) {
        const existing = firebase.apps[0];
        if (existing.options.databaseURL === url) {
          db = existing.database();
          db.ref('.info/connected').on('value', snap => {
            updateConnStatus(snap.val(), 'conn-status');
            updateConnStatus(snap.val(), 'player-conn-status');
          });
          return;
        }
        try { existing.delete(); } catch (e) { }
      }

      try {
        firebase.initializeApp({ apiKey: 'AIzaSyDummy', databaseURL: url });
        db = firebase.database();
        db.ref('.info/connected').on('value', snap => {
          updateConnStatus(snap.val(), 'conn-status');
          updateConnStatus(snap.val(), 'player-conn-status');
        });
      } catch (e) {
        updateConnStatus(false, 'conn-status');
        updateConnStatus(false, 'player-conn-status');
        showToast('‚ùå Firebase error: ' + e.message, 'error');
      }
    }

    function updateConnStatus(connected, elId) {
      const el = document.getElementById(elId);
      if (!el) return;
      if (connected) {
        el.innerHTML = '<span class="conn-badge connected"><span class="conn-dot"></span>Connected to Firebase ‚úÖ</span>';
      } else {
        el.innerHTML = '<span class="conn-badge disconnected"><span class="conn-dot"></span>Disconnected ‚Äî check URL</span>';
      }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // TABS & SCREENS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function switchTab(tab) {
      currentTab = tab;
      document.getElementById('tab-host').classList.toggle('active', tab === 'host');
      document.getElementById('tab-player').classList.toggle('active', tab === 'player');
      if (tab === 'host') {
        if (!roomCode) showScreen('host-login');
        else if (localStatus === 'lobby') showScreen('host-lobby');
        else if (localStatus === 'playing') showScreen('host-dashboard');
        else showScreen('host-gameover');
      } else {
        if (!playerState) showScreen('player-join');
        else if (playerState.joined && playerState.currentQ < 0) showScreen('player-waiting');
        else if (playerState.currentQ >= 0) showScreen('player-game');
        else showScreen('player-rules'); // joined but not yet confirmed ‚Äî show rules
      }
    }

    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      const el = document.getElementById(id);
      if (el) { el.classList.add('active'); el.classList.add('anim-slide'); setTimeout(() => el.classList.remove('anim-slide'), 400); }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // TOAST
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let _tt = null;
    function showToast(msg, type = 'info') {
      const t = document.getElementById('toast');
      t.textContent = msg; t.className = `toast ${type} show`;
      if (_tt) clearTimeout(_tt);
      _tt = setTimeout(() => t.classList.remove('show'), 2800);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // MODAL
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function confirmTerminate() {
      document.getElementById('modal-title').textContent = '‚ö†Ô∏è Terminate Room';
      document.getElementById('modal-body').textContent = 'This will end the session for ALL players. This cannot be undone.';
      modalAction = 'terminate';
      document.getElementById('modal').classList.add('open');
    }
    function confirmEndGame() {
      document.getElementById('modal-title').textContent = 'üèÅ End Game Now?';
      document.getElementById('modal-body').textContent = 'This will stop the game immediately and show final results.';
      modalAction = 'endgame';
      document.getElementById('modal').classList.add('open');
    }
    function closeModal() { document.getElementById('modal').classList.remove('open'); }
    function modalConfirm() {
      closeModal();
      if (modalAction === 'terminate') terminateRoom();
      if (modalAction === 'endgame') hostEndGame();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // UTILS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function esc(s) {
      if (!s) return '';
      return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }
    function shuffleAll() {
      const arr = [...PUZZLES];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr.slice(0, 80);
    }
    function genRoomCode() {
      const w = ['TIGER', 'BLAZE', 'ORBIT', 'PIXEL', 'SPARK', 'FLARE', 'QUEST', 'NOVA', 'ECHO', 'STORM'];
      return w[Math.floor(Math.random() * w.length)] + Math.floor(100 + Math.random() * 900);
    }
    function detachListeners() {
      myListeners.forEach(({ ref, evt, fn }) => ref.off(evt, fn));
      myListeners = [];
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  HOST LOGIC
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function hostLogin() {
      if (!db) { showToast('‚ùå Not connected to Firebase. Please wait‚Ä¶', 'error'); return; }
      const user = document.getElementById('host-username').value.trim();
      const pass = document.getElementById('host-password').value.trim();
      if (!user || !pass) { showToast('Enter username & password', 'error'); return; }
      if (pass !== HOST_PASS) { showToast('‚ùå Wrong password!', 'error'); return; }

      roomCode = genRoomCode();
      localStatus = 'lobby';
      localPlayers = {};
      hostQuestions = shuffleAll();

      // Write initial room to Firebase
      roomRef = db.ref('rooms/' + roomCode);
      roomRef.set({
        hostName: user,
        status: 'lobby',
        currentQ: 0,
        questionStartTime: null,
        totalQPlayed: 0,
        players: {},
        // Store questions without answers visible to players
        questionCount: hostQuestions.length
      }).then(() => {
        document.getElementById('host-room-code').textContent = roomCode;
        showScreen('host-lobby');
        renderLobbyPlayers();
        listenAsHost();
        // Set onDisconnect cleanup
        roomRef.onDisconnect().update({ status: 'terminated' });
      }).catch(e => showToast('Firebase write error: ' + e.message, 'error'));
    }

    function listenAsHost() {
      detachListeners();

      // FIX A: Only sync localPlayers FROM Firebase during lobby.
      // During gameplay, localPlayers is the authoritative source of truth on the host.
      // Overwriting it from Firebase mid-game resets chances/scores that were just computed.
      const playersRef = roomRef.child('players');
      const playersFn = snap => {
        if (localStatus === 'lobby') {
          localPlayers = snap.val() || {};
          renderLobbyPlayers();
          updateStartBtn();
        }
        // During 'playing': do NOT overwrite localPlayers from Firebase here.
      };
      playersRef.on('value', playersFn);
      myListeners.push({ ref: playersRef, evt: 'value', fn: playersFn });

      // FIX B: Use child_added instead of value for actions.
      // .on('value') fired for ALL actions every time ANY action was added/changed ‚Äî
      // causing every action to be processed multiple times and corrupting game state.
      // child_added fires exactly ONCE per action, in order, and never replays old ones.
      const actionsRef = roomRef.child('actions');
      const actionsFn = snap => {
        const action = snap.val();
        if (!action || action.processed) return;
        snap.ref.update({ processed: true });
        handleHostAction(action.type, action.data);
      };
      actionsRef.on('child_added', actionsFn);
      myListeners.push({ ref: actionsRef, evt: 'child_added', fn: actionsFn });
    }

    function handleHostAction(type, data) {
      if (type === 'PLAYER_JOIN') {
        if (data.roomCode !== roomCode) return;
        if (localStatus !== 'lobby') {
          // Send join error
          roomRef.child(`playerMessages/${data.playerId}`).push({
            type: 'JOIN_ERROR', reason: 'Game already started', ts: Date.now()
          });
          return;
        }
        localPlayers[data.playerId] = {
          id: data.playerId, name: data.name,
          score: 0, chances: 3, status: 'online',
          currentAnswer: null, answerStatus: 'waiting',
          correctCount: 0, wrongCount: 0, timeoutCount: 0, deductCount: 0
        };
        // Write updated player list
        roomRef.child('players').set(localPlayers);
        // Send join OK
        roomRef.child(`playerMessages/${data.playerId}`).push({
          type: 'JOIN_OK', roomCode, playerId: data.playerId, ts: Date.now()
        });
      }

      if (type === 'PLAYER_ANSWER') {
        if (data.roomCode !== roomCode) return;
        const player = localPlayers[data.playerId];
        if (!player) return;
        // FIX C: Block players who already answered correctly, ran out of chances, or timed out.
        // Also remove the (||3) fallback which masked 0 chances as truthy, treating 0 as 3.
        if (['correct', 'failed', 'timeout'].includes(player.answerStatus)) return;
        if (player.chances <= 0) return;
        const q = hostQuestions[localCurrentQ];
        if (!q) return;
        const correct = data.answer.toUpperCase().replace(/\s+/g, ' ').trim() === q.answer;
        if (correct) {
          const taken = (Date.now() - (data.questionStartTime || Date.now())) / 1000;
          const bonus = Math.max(0, Math.floor((TIMER_MAX - taken) / (TIMER_MAX / 5)));
          player.score += 10 + bonus;
          player.answerStatus = 'correct';
          player.currentAnswer = data.answer;
          player.correctCount++;
          roomRef.child('players/' + data.playerId).set(player);
          roomRef.child(`playerMessages/${data.playerId}`).push({
            type: 'ANSWER_RESULT', playerId: data.playerId, correct: true,
            score: player.score, bonus, ts: Date.now()
          });
        } else {
          player.chances = Math.max(0, player.chances - 1);
          player.currentAnswer = data.answer;
          player.wrongCount++;
          let deducted = false;
          if (player.chances === 0) {
            player.score = Math.max(0, player.score - DEDUCT_PTS);
            player.answerStatus = 'failed';
            player.deductCount++;
            deducted = true;
          } else {
            player.answerStatus = 'wrong';
          }
          roomRef.child('players/' + data.playerId).set(player);
          roomRef.child(`playerMessages/${data.playerId}`).push({
            type: 'ANSWER_RESULT', playerId: data.playerId, correct: false,
            chances: player.chances, score: player.score, deducted, ts: Date.now()
          });
        }
        renderDashboard();
      }

      if (type === 'PLAYER_TIMEOUT') {
        if (data.roomCode !== roomCode) return;
        const p = localPlayers[data.playerId];
        if (!p) return;
        p.answerStatus = 'timeout'; p.timeoutCount++;
        roomRef.child('players/' + data.playerId).set(p);
        renderDashboard();
      }

      if (type === 'PLAYER_LEFT') {
        if (data.roomCode !== roomCode) return;
        const p = localPlayers[data.playerId];
        if (!p) return;
        p.status = data.aborted ? 'aborted' : 'left';
        roomRef.child('players/' + data.playerId).set(p);
        renderDashboard();
        // Show host notification with rejoin option
        showHostNotif({
          id: 'left_' + data.playerId,
          icon: '‚ö†Ô∏è',
          text: `${p.name} left the game`,
          sub: data.aborted ? 'Tab was closed or switched' : 'Disconnected',
          actions: [
            { label: '‚úÖ Allow Rejoin', cls: 'approve', fn: () => hostApproveRejoin(data.playerId, p.name) },
            { label: '‚ùå Deny', cls: 'deny', fn: () => hostDenyRejoin(data.playerId, p.name) }
          ]
        });
      }

      if (type === 'REJOIN_REQUEST') {
        if (data.roomCode !== roomCode) return;
        const p = localPlayers[data.playerId];
        if (!p) return;
        showHostNotif({
          id: 'rejoin_' + data.playerId,
          icon: 'üôã',
          text: `${p.name} wants to rejoin!`,
          sub: 'Click to allow or deny',
          actions: [
            { label: '‚úÖ Approve', cls: 'approve', fn: () => hostApproveRejoin(data.playerId, p.name) },
            { label: '‚ùå Deny', cls: 'deny', fn: () => hostDenyRejoin(data.playerId, p.name) }
          ]
        });
      }
    }

    // ‚îÄ‚îÄ HOST NOTIFICATIONS ‚îÄ‚îÄ
    const _notifs = {};
    function showHostNotif({ id, icon, text, sub, actions }) {
      if (_notifs[id]) return; // deduplicate
      _notifs[id] = true;
      const bar = document.getElementById('notif-bar');
      const card = document.createElement('div');
      card.className = 'notif-card';
      card.id = 'notif-' + id;
      const btns = actions.map(a =>
        `<button class="notif-btn ${a.cls}" onclick="window._notifAction('${id}',${actions.indexOf(a)})">${a.label}</button>`
      ).join('');
      card.innerHTML = `
        <div style="font-size:24px">${icon}</div>
        <div class="notif-text">${esc(text)}<br><span class="notif-sub">${esc(sub)}</span></div>
        <div class="notif-btn-row">${btns}</div>`;
      bar.appendChild(card);
      window._notifActions = window._notifActions || {};
      window._notifActions[id] = actions.map(a => a.fn);
    }
    window._notifAction = function (id, idx) {
      const fns = window._notifActions?.[id];
      if (fns && fns[idx]) fns[idx]();
      const card = document.getElementById('notif-' + id);
      if (card) card.remove();
      delete _notifs[id];
    };

    function hostApproveRejoin(pid, name) {
      const p = localPlayers[pid];
      if (!p) return;
      p.status = 'online';
      p.chances = 3;
      p.answerStatus = 'waiting';
      p.currentAnswer = null;
      roomRef.child('players/' + pid).set(p);
      roomRef.child('playerMessages/' + pid).push({
        type: 'REJOIN_APPROVED',
        playerId: pid,
        currentQ: localCurrentQ,
        score: p.score,
        correctCount: p.correctCount,
        ts: Date.now()
      });
      renderDashboard();
      showToast(`‚úÖ ${name} approved to rejoin!`, 'success');
    }

    function hostDenyRejoin(pid, name) {
      roomRef.child('playerMessages/' + pid).push({
        type: 'REJOIN_DENIED', playerId: pid, ts: Date.now()
      });
      showToast(`‚ùå ${name} rejoin denied`, 'warn');
    }
    function hostStartGame() {
      if (!roomRef) return;
      if (Object.keys(localPlayers).length === 0) { showToast('No players in room!', 'error'); return; }

      localStatus = 'playing';
      localCurrentQ = 0;
      const now = Date.now();

      // Reset all players
      Object.keys(localPlayers).forEach(id => {
        localPlayers[id].chances = 3;
        localPlayers[id].answerStatus = 'waiting';
        localPlayers[id].currentAnswer = null;
      });

      // Write game start to Firebase ‚Äî players listen for 'status' change
      const q = hostQuestions[0];
      roomRef.update({
        status: 'playing',
        currentQ: 0,
        questionStartTime: now,
        totalQPlayed: 0,
        players: localPlayers,
        // Current question visible to players (no answers)
        currentQuestion: { images: q.images, hint: q.hint, index: 0, letterCount: q.answer.replace(/\s/g, '').length, wordCount: q.answer.split(' ').length, firstLetter: q.answer[0], lastLetter: q.answer[q.answer.length - 1] }
      });

      showScreen('host-dashboard');
      renderDashboard();
      startHostTimer();
    }

    function startHostTimer() {
      clearInterval(gameTimer);
      timerSeconds = TIMER_MAX;
      document.getElementById('hd-timer').textContent = timerSeconds;
      gameTimer = setInterval(() => {
        timerSeconds--;
        document.getElementById('hd-timer').textContent = timerSeconds;
        if (timerSeconds <= 0) { clearInterval(gameTimer); hostNextQuestion(); }
      }, 1000);
    }

    function hostNextQuestion() {
      clearInterval(gameTimer);
      const q = hostQuestions[localCurrentQ];
      if (!q) return;

      // Reveal answer to all players
      roomRef.child('broadcast').push({ type: 'QUESTION_REVEAL', answer: q.answer, ts: Date.now() });

      if (localCurrentQ >= 79) {
        setTimeout(() => hostEndGame(), 3000);
        return;
      }

      localCurrentQ++;
      const now = Date.now();

      // Reset player states for new question
      Object.keys(localPlayers).forEach(id => {
        if (localPlayers[id].status === 'online') {
          localPlayers[id].chances = 3;
          localPlayers[id].answerStatus = 'waiting';
          localPlayers[id].currentAnswer = null;
        }
      });

      const nextQ = hostQuestions[localCurrentQ];
      roomRef.update({
        totalQPlayed: firebase.database.ServerValue.increment(1)
      });

      setTimeout(() => {
        roomRef.update({
          currentQ: localCurrentQ,
          questionStartTime: now,
          players: localPlayers,
          currentQuestion: { images: nextQ.images, hint: nextQ.hint, index: localCurrentQ, letterCount: nextQ.answer.replace(/\s/g, '').length, wordCount: nextQ.answer.split(' ').length, firstLetter: nextQ.answer[0], lastLetter: nextQ.answer[nextQ.answer.length - 1] }
        });
        renderDashboard();
        startHostTimer();
      }, 3000);
    }

    function hostForceNext() { clearInterval(gameTimer); hostNextQuestion(); }

    function hostEndGame() {
      clearInterval(gameTimer);
      localStatus = 'gameover';
      roomRef.update({ status: 'gameover', players: localPlayers });
      renderFinalDashboard({ players: localPlayers, totalQPlayed: localCurrentQ + 1 });
      showScreen('host-gameover');
    }

    function terminateRoom() {
      clearInterval(gameTimer);
      if (roomRef) {
        roomRef.update({ status: 'terminated' });
        setTimeout(() => { if (roomRef) roomRef.remove(); }, 2000);
      }
      detachListeners();
      roomRef = null; roomCode = null; localPlayers = {}; localStatus = 'lobby';
      showScreen('host-login');
      showToast('üóëÔ∏è Room terminated', 'info');
    }

    function hostNewGame() {
      clearInterval(gameTimer); detachListeners();
      roomRef = null; roomCode = null; localPlayers = {}; localStatus = 'lobby';
      showScreen('host-login');
    }

    // ‚îÄ‚îÄ HOST RENDER ‚îÄ‚îÄ
    function renderLobbyPlayers() {
      const el = document.getElementById('lobby-player-list');
      const players = Object.values(localPlayers);
      el.innerHTML = players.length === 0
        ? '<div class="empty"><span class="icon">‚è≥</span>Waiting for players‚Ä¶</div>'
        : players.map(p => `<div class="score-row">
        <div style="font-size:22px">üéÆ</div>
        <div style="flex:1;padding:0 12px;font-weight:700">${esc(p.name)}</div>
        <span class="badge badge-waiting">Ready</span></div>`).join('');
      document.getElementById('host-room-code').textContent = roomCode || '----';
      updateStartBtn();
    }

    function updateStartBtn() {
      const btn = document.getElementById('start-game-btn');
      if (!btn) return;
      const n = Object.keys(localPlayers).length;
      btn.disabled = n === 0;
      btn.textContent = n > 0 ? `‚ñ∂Ô∏è Start Game (${n} players)` : '‚ñ∂Ô∏è Start Game';
    }

    function renderDashboard() {
      const q = hostQuestions ? hostQuestions[localCurrentQ] : null;
      document.getElementById('hd-q-num').textContent = localCurrentQ + 1;
      document.getElementById('hd-q-label').textContent = `Question ${localCurrentQ + 1} of 80`;
      renderClueChips('hd-clue-chips', q ? q.images : null, true);
      document.getElementById('hd-player-count').textContent = Object.keys(localPlayers).length;
      if (q) {
        document.getElementById('hd-answer').textContent = q.answer;
        const hb = document.getElementById('hd-hint-badge');
        const ht = document.getElementById('hd-hint-text');
        if (hb && ht) {
          hb.style.display = 'inline-flex';
          ht.textContent = `${q.hint}  ‚Ä¢  ${q.answer.length} letters  ‚Ä¢  Starts with "${q.answer[0]}"`;
        }
      }
      renderScoresList();
      renderAnswersList();
      renderPlayersList();
    }

    function renderScoresList() {
      const el = document.getElementById('scores-list');
      if (!el) return;
      const sorted = Object.values(localPlayers).sort((a, b) => b.score - a.score);
      if (!sorted.length) { el.innerHTML = '<div class="empty">No players yet</div>'; return; }
      el.innerHTML = sorted.map((p, i) => `<div class="score-row">
    <div class="rank ${i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : ''}">${i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : '#' + (i + 1)}</div>
    <div class="name">${esc(p.name)}<br><small style="color:var(--muted);font-weight:400">${p.status === 'aborted' ? 'üö´ Aborted' : p.status === 'left' ? 'üîå Left' : '‚úÖ Active'}</small></div>
    <div class="pts">${p.score}</div></div>`).join('');
    }

    function renderAnswersList() {
      const el = document.getElementById('answers-list');
      if (!el) return;
      const players = Object.values(localPlayers);
      if (!players.length) { el.innerHTML = '<div class="empty">No players yet</div>'; return; }
      el.innerHTML = players.map(p => {
        const st = p.answerStatus;
        const badge = st === 'correct' ? 'badge-correct' : st === 'timeout' ? 'badge-timeout' : st === 'waiting' ? 'badge-waiting' : st === 'failed' ? 'badge-failed' : 'badge-wrong';
        const label = st === 'correct' ? '‚úÖ Correct' : st === 'timeout' ? '‚è±Ô∏è Timeout' : st === 'waiting' ? '‚åõ Waiting' : st === 'failed' ? 'üíî Failed ‚àí5' : '‚ùå Wrong';
        return `<div class="score-row">
      <div style="flex:1">
        <div style="font-weight:700;font-size:13px">${esc(p.name)}</div>
        <div style="color:var(--muted);font-size:12px;margin-top:2px">${p.currentAnswer ? `"${esc(p.currentAnswer)}"` : 'No answer yet'}</div>
      </div><span class="badge ${badge}">${label}</span></div>`;
      }).join('');
    }

    function renderPlayersList() {
      const el = document.getElementById('players-list');
      if (!el) return;
      const players = Object.values(localPlayers);
      if (!players.length) { el.innerHTML = '<div class="empty" style="padding:20px">No players</div>'; return; }
      el.innerHTML = `<table class="player-table">
    <thead><tr><th>Player</th><th>Status</th><th>‚ù§Ô∏è</th><th>‚úÖ</th><th>üíî</th></tr></thead>
    <tbody>${players.map(p => `<tr>
      <td style="font-weight:700;font-size:13px">${esc(p.name)}</td>
      <td><span class="status-dot ${p.status}"></span>${p.status}</td>
      <td>${p.chances}</td>
      <td style="color:var(--green)">${p.correctCount}</td>
      <td style="color:var(--red)">${p.deductCount || 0}</td>
    </tr>`).join('')}</tbody></table>`;
    }

    function showDashTab(tab, e) {
      document.querySelectorAll('.dash-panel').forEach(p => p.style.display = 'none');
      document.querySelectorAll('.dash-tab').forEach(t => t.classList.remove('active'));
      document.getElementById('dash-' + tab).style.display = 'block';
      if (e && e.target) e.target.classList.add('active');
    }

    // ‚îÄ‚îÄ HOST FINAL DASHBOARD ‚îÄ‚îÄ
    function renderFinalDashboard(state) {
      const sorted = Object.values(state.players).sort((a, b) => b.score - a.score);
      const qPlayed = state.totalQPlayed || (localCurrentQ + 1);
      document.getElementById('host-go-sub').innerHTML =
        `Completed after <strong style="color:var(--neon)">${qPlayed}</strong> questions ¬∑ ${sorted.length} players`;
      const top3 = sorted.slice(0, 3);
      const order = [top3[1], top3[0], top3[2]].filter(Boolean);
      const cls = ['second', 'first', 'third'];
      const nums = ['2', '1', '3'];
      document.getElementById('host-podium').innerHTML = order.map((p, i) => `
    <div class="podium-slot">
      <div style="font-size:13px;font-weight:800;text-align:center;color:var(--text);max-width:80px;word-break:break-word">${esc(p.name)}</div>
      <div style="font-family:'Fredoka One',cursive;color:var(--accent);font-size:18px">${p.score}</div>
      <div class="podium-block ${cls[i]}"><div class="podium-name">${nums[i]}</div></div>
    </div>`).join('');
      document.getElementById('host-final-scores').innerHTML = sorted.map((p, i) => `
    <div class="score-row">
      <div class="rank ${i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : ''}">${i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : '#' + (i + 1)}</div>
      <div class="name">${esc(p.name)}<br>
        <small style="color:var(--muted);font-weight:400">‚úÖ ${p.correctCount} correct &nbsp;üíî ${p.deductCount || 0} deducted</small></div>
      <div class="pts">${p.score}</div>
    </div>`).join('');
      const totalPlayers = sorted.length || 1;
      const avgScore = Math.round(sorted.reduce((s, p) => s + p.score, 0) / totalPlayers);
      const avgCorrect = Math.round(sorted.reduce((s, p) => s + p.correctCount, 0) / totalPlayers);
      const totalDeductions = sorted.reduce((s, p) => s + (p.deductCount || 0), 0);
      document.getElementById('host-final-perf').innerHTML = `
    <div class="final-stat-grid">
      <div class="final-stat"><div class="fs-val">${qPlayed}</div><div class="fs-label">Questions Played</div></div>
      <div class="final-stat"><div class="fs-val">${totalPlayers}</div><div class="fs-label">Total Players</div></div>
      <div class="final-stat"><div class="fs-val">${avgScore}</div><div class="fs-label">Average Score</div></div>
      <div class="final-stat"><div class="fs-val">${avgCorrect}</div><div class="fs-label">Avg Correct</div></div>
      <div class="final-stat"><div class="fs-val" style="color:var(--red)">${totalDeductions}</div><div class="fs-label">Total Deductions</div></div>
      <div class="final-stat"><div class="fs-val" style="color:var(--green)">${sorted[0] ? sorted[0].score : 0}</div><div class="fs-label">Top Score</div></div>
    </div>
    <div style="margin-top:12px">
    ${sorted.map((p, i) => `<div class="score-row">
      <div style="font-size:14px;font-weight:700;flex:1">${i + 1}. ${esc(p.name)}</div>
      <div style="font-size:12px;color:var(--muted);text-align:right">‚úÖ${p.correctCount} &nbsp;‚ùå${p.wrongCount} &nbsp;‚è±Ô∏è${p.timeoutCount} &nbsp;<span style="color:var(--red)">üíî√ó${p.deductCount || 0}</span></div>
    </div>`).join('')}
    </div>`;
      const topScore = sorted[0];
      const topAccurate = [...sorted].sort((a, b) => b.correctCount - a.correctCount)[0];
      const topStreak = [...sorted].sort((a, b) => (b.correctCount / (b.correctCount + b.wrongCount + b.timeoutCount + .001)) - (a.correctCount / (a.correctCount + a.wrongCount + a.timeoutCount + .001)))[0];
      const leastDeduct = sorted.filter(p => p.deductCount === 0);
      document.getElementById('host-final-mvp').innerHTML = `
    ${topScore ? `<div class="mvp-card"><div class="mvp-icon">üèÜ</div><div><div class="mvp-name">${esc(topScore.name)}</div><div class="mvp-desc">Highest Score</div></div><div class="mvp-val">${topScore.score} pts</div></div>` : ''}
    ${topAccurate ? `<div class="mvp-card"><div class="mvp-icon">üéØ</div><div><div class="mvp-name">${esc(topAccurate.name)}</div><div class="mvp-desc">Most Correct Answers</div></div><div class="mvp-val">${topAccurate.correctCount} ‚úÖ</div></div>` : ''}
    ${topStreak ? `<div class="mvp-card"><div class="mvp-icon">‚ö°</div><div><div class="mvp-name">${esc(topStreak.name)}</div><div class="mvp-desc">Best Accuracy Rate</div></div><div class="mvp-val">${Math.round(topStreak.correctCount / (topStreak.correctCount + topStreak.wrongCount + topStreak.timeoutCount + .001) * 100)}%</div></div>` : ''}
    ${leastDeduct.length > 0 ? `<div class="mvp-card" style="border-color:rgba(6,214,160,.35);background:linear-gradient(135deg,rgba(6,214,160,.1),rgba(6,214,160,.05))"><div class="mvp-icon">üíö</div><div><div class="mvp-name">${leastDeduct.map(p => esc(p.name)).join(', ')}</div><div class="mvp-desc">Zero Deductions ‚Äî Perfect Composure!</div></div><div class="mvp-val">0 üíî</div></div>` : ''}`;
    }

    function showFinalTab(tab, e) {
      document.querySelectorAll('.final-panel').forEach(p => p.style.display = 'none');
      document.querySelectorAll('.dash-tab').forEach(t => t.classList.remove('active'));
      document.getElementById('final-' + tab).style.display = 'block';
      if (e && e.target) e.target.classList.add('active');
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  PLAYER LOGIC
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function playerJoin() {
      if (!db) { showToast('‚ùå Not connected to Firebase. Please wait‚Ä¶', 'error'); return; }
      const name = document.getElementById('player-name').value.trim();
      const code = document.getElementById('player-room-code').value.trim().toUpperCase();
      if (!name) { showToast('Enter your name!', 'error'); return; }
      if (!code) { showToast('Enter room code!', 'error'); return; }

      const pid = 'p_' + Date.now() + '_' + Math.random().toString(36).slice(2, 6);
      playerState = {
        id: pid, name, roomCode: code,
        score: 0, chances: 3, currentQ: -1,
        questions: [], joined: false,
        correctCount: 0, wrongCount: 0, timeoutCount: 0, deductCount: 0,
        questionStartTime: null
      };

      // Check room exists
      const pRoomRef = db.ref('rooms/' + code);
      pRoomRef.once('value').then(snap => {
        if (!snap.exists()) {
          showToast('‚ùå Room not found!', 'error');
          playerState = null;
          return;
        }
        const room = snap.val();
        if (room.status !== 'lobby') {
          showToast('‚ùå Game already started!', 'error');
          playerState = null;
          return;
        }
        // Send join action
        pRoomRef.child('actions').push({ type: 'PLAYER_JOIN', data: { playerId: pid, name, roomCode: code }, ts: Date.now(), processed: false });
        // Show rules before entering waiting room
        document.getElementById('pw-name').textContent = `üëã Hello, ${name}!`;
        document.getElementById('pw-room').textContent = code;
        listenAsPlayer(pRoomRef, code, pid);
        rGoTo(0); // reset rules to first tab
        showScreen('player-rules');
      }).catch(e => {
        showToast('‚ùå Cannot reach Firebase', 'error');
        playerState = null;
      });
    }

    function listenAsPlayer(pRoomRef, code, pid) {
      // FIX D1: child_added for player messages fires ONCE per message, never replays old ones.
      // The old .on('value') iterated ALL messages on every new arrival ‚Äî so a single
      // new ANSWER_RESULT caused ALL previous ANSWER_RESULTs to re-fire, corrupting
      // chances and score on the player side.
      const msgRef = pRoomRef.child('playerMessages/' + pid);
      const msgFn = snap => {
        const msg = snap.val();
        if (msg) handlePlayerMsg(msg.type, msg);
      };
      msgRef.on('child_added', msgFn);
      myListeners.push({ ref: msgRef, evt: 'child_added', fn: msgFn });

      // FIX D2: child_added for broadcast ‚Äî old .on('value') replayed every QUESTION_REVEAL
      // on every Firebase update, calling showRevealBanner repeatedly mid-question.
      const bcRef = pRoomRef.child('broadcast');
      const bcFn = snap => {
        const msg = snap.val();
        if (msg && playerState && msg.type === 'QUESTION_REVEAL') showRevealBanner(msg.answer);
      };
      bcRef.on('child_added', bcFn);
      myListeners.push({ ref: bcRef, evt: 'child_added', fn: bcFn });

      // Room-level .on('value') is correct here ‚Äî we need to react to status/question changes
      const roomFn = snap => {
        const room = snap.val();
        if (!room || !playerState) return;
        if (room.status === 'terminated') {
          showToast('üóëÔ∏è Host terminated the room', 'error');
          detachListeners();
          playerState = null;
          showScreen('player-join');
          return;
        }
        if (room.status === 'gameover' && playerState.currentQ >= 0) {
          clearInterval(playerTimerInterval);
          clearInterval(autoNextTimer);
          showPlayerGameOver(room.players);
          return;
        }
        if (room.status === 'playing') {
          const q = room.currentQuestion;
          const qIdx = room.currentQ;
          if (!playerState.joined) return;

          if (playerState.currentQ < 0) {
            // Game just started
            playerState.currentQ = 0;
            playerState.score = 0;
            playerState.chances = 3;
            playerState.questionStartTime = room.questionStartTime;
            if (q) {
              playerState.questions[0] = q;
              setupTabLeave(pRoomRef, code, pid);
              showScreen('player-game');
              startPlayerQuestion();
            }
          } else if (qIdx > playerState.currentQ) {
            // New question from host
            playerState.currentQ = qIdx;
            playerState.chances = 3;
            playerState.questionStartTime = room.questionStartTime;
            if (q) playerState.questions[qIdx] = q;
            clearInterval(playerTimerInterval); clearInterval(autoNextTimer);
            startPlayerQuestion();
          }
        }
      };
      pRoomRef.on('value', roomFn);
      myListeners.push({ ref: pRoomRef, evt: 'value', fn: roomFn });

      // Waiting room player list
      const plRef = pRoomRef.child('players');
      const plFn = snap => {
        const players = snap.val() || {};
        if (document.getElementById('player-waiting').classList.contains('active')) {
          renderWaitingList(players);
        }
      };
      plRef.on('value', plFn);
      myListeners.push({ ref: plRef, evt: 'value', fn: plFn });

    }

    function handlePlayerMsg(type, msg) {
      if (!playerState) return;

      if (type === 'JOIN_OK' && msg.playerId === playerState.id) {
        playerState.joined = true;
        showToast('‚úÖ Joined successfully!', 'success');
        return; // ‚Üê FIX: stop here, don't fall into ANSWER_RESULT logic
      }
      if (type === 'JOIN_ERROR' && msg.playerId === playerState.id) {
        showToast('‚ùå ' + msg.reason, 'error');
        detachListeners();
        playerState = null;
        showScreen('player-join');
        return; // ‚Üê FIX
      }
      if (type === 'REJOIN_APPROVED' && msg.playerId === playerState.id) {
        playerAborted = false;
        playerState.currentQ = msg.currentQ;
        playerState.score = msg.score;
        playerState.correctCount = msg.correctCount;
        playerState.chances = 3;
        document.getElementById('abort-screen').classList.remove('show');
        document.getElementById('rejoin-btn').style.display = 'none';
        document.getElementById('rejoin-btn').disabled = false;
        document.getElementById('rejoin-status').textContent = '';
        showToast('‚úÖ Rejoined! Game continues‚Ä¶', 'success');
        showScreen('player-game');
        return; // ‚Üê FIX
      }
      if (type === 'REJOIN_DENIED' && msg.playerId === playerState.id) {
        const status = document.getElementById('rejoin-status');
        const btn = document.getElementById('rejoin-btn');
        if (status) status.textContent = '‚ùå Host denied your rejoin request.';
        if (btn) { btn.disabled = false; btn.style.display = 'none'; }
        showToast('‚ùå Rejoin denied by host', 'error');
        return; // ‚Üê FIX
      }

      // Only ANSWER_RESULT messages reach here
      if (type !== 'ANSWER_RESULT') return; // ‚Üê FIX: guard for any unknown types
      if (msg.correct) {
        playerState.score = msg.score;
        playerState.correctCount++;
        showAnswerResult(true, msg.bonus);
      } else {
        playerState.chances = msg.chances;
        playerState.wrongCount++;
        if (msg.deducted) {
          playerState.score = msg.score;
          playerState.deductCount++;
        }
        showAnswerResult(false, 0, msg.deducted);
      }
    }


    // ‚îÄ‚îÄ PLAYER GAME LOGIC ‚îÄ‚îÄ
    function startPlayerQuestion() {
      clearInterval(playerTimerInterval);
      playerTimerInterval = null;
      playerTimerSecs = TIMER_MAX;
      const q = playerState.questions ? playerState.questions[playerState.currentQ] : null;
      if (!q) return;

      const qNum = playerState.currentQ + 1;
      document.getElementById('pg-q-number').textContent = `QUESTION ${qNum} OF 80`;
      document.getElementById('pg-q-label').textContent = `Q ${qNum}/80`;
      document.getElementById('pg-progress').style.width = `${(qNum / 80) * 100}%`;
      renderClueChips('pg-clue-chips', q.images, false);
      document.getElementById('player-answer').value = '';
      document.getElementById('player-answer').disabled = false;
      document.getElementById('pg-solved-count').textContent = `${playerState.correctCount} / 80`;
      document.getElementById('answer-section').style.display = 'block';
      document.getElementById('result-section').style.display = 'none';
      document.getElementById('result-section').innerHTML = '';

      resetHints(q);
      renderChances();
      updateArc(TIMER_MAX, TIMER_MAX);

      playerTimerInterval = setInterval(() => {
        playerTimerSecs--;
        updateArc(playerTimerSecs, TIMER_MAX);

        if (playerTimerSecs <= 5) document.getElementById('timer-arc').style.stroke = 'var(--red)';
        else if (playerTimerSecs <= 12) document.getElementById('timer-arc').style.stroke = 'var(--yellow)';
        else document.getElementById('timer-arc').style.stroke = 'var(--neon)';

        if (playerTimerSecs === HINT2_AT) { unlockHint(1, q); showToast('üí° Letter hint unlocked!', 'info'); }
        if (playerTimerSecs === HINT3_AT) { unlockHint(2, q); showToast('üîë Final hint unlocked!', 'info'); }

        if (playerTimerSecs <= 0) {
          clearInterval(playerTimerInterval);
          sendPlayerAction('PLAYER_TIMEOUT', { playerId: playerState.id, roomCode: playerState.roomCode });
          playerState.timeoutCount++;
          document.getElementById('player-answer').disabled = true;
          document.getElementById('answer-section').style.display = 'none';
          document.getElementById('result-section').innerHTML = `
        <div class="reveal-banner" style="background:linear-gradient(135deg,#b8860b,#7b5800)">
          <div style="font-size:20px">‚è±Ô∏è Time's up!</div>
          <div class="sub">Waiting for next question‚Ä¶</div></div>`;
          document.getElementById('result-section').style.display = 'block';
        }
      }, 1000);
    }

    function sendPlayerAction(type, data) {
      if (!db || !playerState) return;
      db.ref('rooms/' + playerState.roomCode + '/actions').push({
        type, data, ts: Date.now(), processed: false
      });
    }

    function submitAnswer() {
      if (!playerState || !playerState.questions) return;
      if (playerTimerSecs <= 0 || playerState.chances <= 0) return;
      const val = document.getElementById('player-answer').value.trim();
      if (!val) { showToast('Type your answer!', 'error'); return; }
      sendPlayerAction('PLAYER_ANSWER', {
        playerId: playerState.id,
        roomCode: playerState.roomCode,
        answer: val,
        questionIndex: playerState.currentQ,
        questionStartTime: playerState.questionStartTime
      });
      document.getElementById('player-answer').value = '';
    }

    function showAnswerResult(correct, bonus = 0, deducted = false) {
      const gc = document.getElementById('game-card');
      const q = playerState.questions ? playerState.questions[playerState.currentQ] : null;

      if (correct) {
        clearInterval(playerTimerInterval); clearTimeout(autoNextTimer);
        document.getElementById('answer-section').style.display = 'none';
        document.getElementById('pg-solved-count').textContent = `${playerState.correctCount} / 80`;
        let cd = 3;
        document.getElementById('result-section').innerHTML = `
      <div class="reveal-banner">
        <div style="font-size:26px">üéâ Correct!</div>
        <div class="sub">${bonus > 0 ? 'Speed bonus earned! ‚ö°' : 'Keep it up!'}</div>
        <div class="auto-next-bar"><div class="auto-next-fill" id="anf" style="width:100%"></div></div>
        <div class="auto-next-label" id="anl">Next in ${cd}s‚Ä¶</div></div>`;
        document.getElementById('result-section').style.display = 'block';
        gc.classList.add('flash-correct');
        setTimeout(() => gc.classList.remove('flash-correct'), 500);
        setTimeout(() => { const f = document.getElementById('anf'); if (f) f.style.width = '0%'; }, 50);
        autoNextTimer = setInterval(() => {
          cd--;
          const l = document.getElementById('anl');
          if (l) l.textContent = cd > 0 ? `Next in ${cd}s‚Ä¶` : '‚è≥ Waiting for host‚Ä¶';
          if (cd <= 0) clearInterval(autoNextTimer);
        }, 1000);
      } else {
        gc.classList.add('flash-wrong');
        setTimeout(() => gc.classList.remove('flash-wrong'), 500);
        const chancesGone = 3 - playerState.chances;
        if (chancesGone >= 1 && q) unlockHint(1, q);
        if (chancesGone >= 2 && q) unlockHint(2, q);
        renderChances();
        if (playerState.chances === 0) {
          clearInterval(playerTimerInterval);
          document.getElementById('player-answer').disabled = true;
          document.getElementById('answer-section').style.display = 'none';
          let html = `<div class="deduct-banner"><div class="deduct-word">üíî No Chances Left!</div>`;
          if (deducted) html += `<div class="deduct-sub">‚ö†Ô∏è Score deduction applied!</div>`;
          html += `<div class="deduct-sub" style="margin-top:6px">Waiting for next question‚Ä¶</div></div>`;
          document.getElementById('result-section').innerHTML = html;
          document.getElementById('result-section').style.display = 'block';
          if (deducted) showToast(`üíî Score deduction applied!`, 'error');
        } else {
          showToast(`‚ùå Wrong! ${playerState.chances} chance${playerState.chances !== 1 ? 's' : ''} left`, 'error');
          document.getElementById('player-answer').classList.add('anim-shake');
          setTimeout(() => document.getElementById('player-answer').classList.remove('anim-shake'), 400);
        }
      }
    }

    function showRevealBanner(answer) {
      clearInterval(playerTimerInterval);
      const rs = document.getElementById('result-section');
      if (!rs.innerHTML.includes('Correct') && !rs.innerHTML.includes('No Chances')) {
        document.getElementById('answer-section').style.display = 'none';
        rs.innerHTML = `<div class="reveal-banner" style="background:linear-gradient(135deg,var(--accent2),var(--accent3))">
      <div style="font-size:13px;color:rgba(255,255,255,.75);margin-bottom:6px">The answer was:</div>
      <div class="answer-word">${answer}</div>
      <div class="sub">Next question loading‚Ä¶</div></div>`;
        rs.style.display = 'block';
      }
    }

    function showPlayerGameOver(players) {
      const me = players[playerState.id];
      // Show a motivational emoji based on correct count only (no rank/score leak)
      const correct = me ? me.correctCount : playerState.correctCount || 0;
      const emoji = correct >= 60 ? 'üèÜ' : correct >= 40 ? 'üéØ' : correct >= 20 ? 'üí™' : 'üéÆ';
      document.getElementById('go-emoji').textContent = emoji;
      document.getElementById('final-rank-msg').textContent = 'Great game ‚Äî check the host screen for results!';
      document.getElementById('go-stats').innerHTML = `
    <div class="score-row"><div style="flex:1">‚úÖ Correct answers</div><div style="font-family:'Fredoka One',cursive;color:var(--green)">${me ? me.correctCount : 0}</div></div>
    <div class="score-row"><div style="flex:1">‚ùå Wrong attempts</div><div style="font-family:'Fredoka One',cursive;color:var(--muted)">${me ? me.wrongCount : 0}</div></div>
    <div class="score-row"><div style="flex:1">‚è±Ô∏è Timeouts</div><div style="font-family:'Fredoka One',cursive;color:var(--yellow)">${me ? me.timeoutCount : 0}</div></div>
    <div class="score-row"><div style="flex:1">üíî Score deductions</div><div style="font-family:'Fredoka One',cursive;color:var(--red)">${me ? (me.deductCount || 0) : 0}√ó</div></div>`;
      showScreen('player-gameover');
    }

    function playerGoHome() {
      detachListeners();
      playerState = null;
      showScreen('player-join');
    }

    function renderWaitingList(players) {
      const el = document.getElementById('pw-player-list');
      const list = Object.values(players);
      el.innerHTML = !list.length
        ? '<div class="empty">No players yet</div>'
        : list.map(p => `<div class="score-row">
        <div style="font-size:18px">üïπÔ∏è</div>
        <div style="flex:1;padding:0 10px;font-weight:700;font-size:14px">${esc(p.name)}</div>
        <span class="badge badge-waiting">Ready</span></div>`).join('');
    }

    // ‚îÄ‚îÄ HINTS ‚îÄ‚îÄ
    // FIX E: The host strips q.answer before sending to Firebase so players can't cheat.
    // Old code accessed p.answer directly ‚Äî undefined on player side ‚Äî crashing the timer
    // and breaking hint unlock. Now falls back gracefully when answer is not present.
    function getHints(p) {
      const hint = p.hint || '?';
      const len = p.letterCount || (p.answer ? p.answer.replace(/\s/g, '').length : 0);
      const words = p.wordCount || (p.answer ? p.answer.split(' ').length : 1);
      const first = p.firstLetter || (p.answer ? p.answer[0] : '?');
      const last = p.lastLetter || (p.answer ? p.answer[p.answer.length - 1] : '?');
      const wordNote = words > 1 ? ` (${words} words)` : '';
      return [
        hint + wordNote,
        len > 0 ? first + ' ' + Array(len - 1).fill('_').join(' ') : '_ _ _ _ _',
        len > 0 ? first + ' ' + Array(Math.max(0, len - 2)).fill('¬∑').join(' ') + ' ' + last : '? ‚Ä¶ ?'
      ];
    }
    function resetHints(puz) {
      const h = getHints(puz);
      const r0 = document.getElementById('hint-row-0');
      const v0 = document.getElementById('hint-0');
      if (r0) { r0.classList.remove('locked'); r0.classList.add('unlocked'); r0.style.background = ''; }
      if (v0) { v0.classList.remove('masked'); v0.textContent = h[0]; }
      [1, 2].forEach(i => {
        const row = document.getElementById(`hint-row-${i}`);
        const val = document.getElementById(`hint-${i}`);
        if (row) { row.classList.add('locked'); row.classList.remove('unlocked'); row.style.background = ''; }
        if (val) { val.classList.add('masked'); val.textContent = i === 1 ? '_ _ _ _ _' : '? ‚Ä¶ ?'; }
      });
    }
    function unlockHint(level, puz) {
      const h = getHints(puz);
      const row = document.getElementById(`hint-row-${level}`);
      const val = document.getElementById(`hint-${level}`);
      if (!row || !val) return;
      row.classList.remove('locked'); row.classList.add('unlocked');
      val.classList.remove('masked'); val.textContent = h[level];
      row.style.background = 'rgba(255,209,102,.25)';
      setTimeout(() => { row.style.background = ''; }, 700);
    }

    // ‚îÄ‚îÄ ARC / CHANCES ‚îÄ‚îÄ
    function updateArc(cur, max) {
      const C = 226.19;
      const arc = document.getElementById('timer-arc');
      const txt = document.getElementById('timer-text');
      if (arc) arc.style.strokeDashoffset = C * (1 - cur / max);
      if (txt) txt.textContent = cur;
    }
    function renderChances() {
      const el = document.getElementById('chances-display');
      el.innerHTML = '';
      for (let i = 0; i < 3; i++) {
        const s = document.createElement('span');
        s.className = 'heart' + (i >= playerState.chances ? ' lost' : '');
        s.textContent = '‚ù§Ô∏è';
        el.appendChild(s);
      }
    }

    // ‚îÄ‚îÄ TAB LEAVE ‚îÄ‚îÄ
    function setupTabLeave(pRoomRef, code, pid) {
      document.addEventListener('visibilitychange', () => {
        if (document.hidden && currentTab === 'player' && playerState && playerState.currentQ >= 0) triggerAbort(code, pid);
      });
      window.addEventListener('beforeunload', () => {
        if (currentTab === 'player' && playerState && playerState.currentQ >= 0) {
          sendPlayerAction('PLAYER_LEFT', { playerId: pid, roomCode: code, aborted: true });
        }
      });
    }
    function triggerAbort(code, pid) {
      if (playerAborted) return;
      playerAborted = true;
      clearInterval(playerTimerInterval);
      sendPlayerAction('PLAYER_LEFT', { playerId: pid, roomCode: code, aborted: true });
      document.getElementById('abort-screen').classList.add('show');
      // Show rejoin button after a short delay
      setTimeout(() => {
        const btn = document.getElementById('rejoin-btn');
        if (btn) btn.style.display = 'inline-block';
      }, 2000);
    }

    function requestRejoin() {
      if (!playerState) return;
      const btn = document.getElementById('rejoin-btn');
      const status = document.getElementById('rejoin-status');
      if (btn) btn.disabled = true;
      if (status) status.textContent = '‚è≥ Request sent ‚Äî waiting for host approval‚Ä¶';
      sendPlayerAction('REJOIN_REQUEST', {
        playerId: playerState.id,
        roomCode: playerState.roomCode,
        name: playerState.name
      });
    }

    function togglePwd() {
      const inp = document.getElementById('host-password');
      const btn = document.getElementById('pwd-eye');
      if (inp.type === 'password') { inp.type = 'text'; btn.textContent = 'üôà'; }
      else { inp.type = 'password'; btn.textContent = 'üëÅÔ∏è'; }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // RULES SCREEN NAVIGATION
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let rCurrent = 0;
    const R_TOTAL = 5;

    function rGoTo(idx) {
      rCurrent = Math.max(0, Math.min(R_TOTAL - 1, idx));
      const track = document.getElementById('rSlidesTrack');
      if (track) track.style.transform = `translateX(-${rCurrent * 100}%)`;
      document.querySelectorAll('.r-tab-pill').forEach((p, i) => p.classList.toggle('active', i === rCurrent));
      document.querySelectorAll('.r-dot').forEach((d, i) => d.classList.toggle('active', i === rCurrent));
      const pills = document.querySelectorAll('.r-tab-pill');
      if (pills[rCurrent]) pills[rCurrent].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
    }

    function rulesStart() {
      showScreen('player-waiting');
    }

    // Touch swipe for rules slides
    (function () {
      let sx = 0, sy = 0;
      const outer = document.getElementById('rSlidesOuter');
      if (!outer) return;
      outer.addEventListener('touchstart', e => { sx = e.touches[0].clientX; sy = e.touches[0].clientY; }, { passive: true });
      outer.addEventListener('touchend', e => {
        const dx = e.changedTouches[0].clientX - sx;
        const dy = e.changedTouches[0].clientY - sy;
        if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 40) rGoTo(rCurrent + (dx < 0 ? 1 : -1));
      }, { passive: true });
    })();

    // ‚îÄ‚îÄ KEYBOARD ‚îÄ‚îÄ
    document.addEventListener('keydown', e => {
      if (e.key !== 'Enter') return;
      const active = document.querySelector('.screen.active');
      if (!active) return;
      if (active.id === 'player-game') submitAnswer();
      if (active.id === 'player-join') playerJoin();
      if (active.id === 'host-login') hostLogin();
    });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // CLUE CHIPS ‚Äî syllabic emoji keys (each puzzle uses 2 emojis
    // whose names join to form the compound-word answer)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const CLUE_EMOJI = {
      // ‚îÄ‚îÄ syllabic word parts ‚îÄ‚îÄ
      'sun':       '‚òÄÔ∏è',
      'set':       'üåÖ',
      'star':      '‚≠ê',
      'fish':      'üêü',
      'moon':      'üåô',
      'light':     'üí°',
      'bee':       'üêù',
      'hive':      'üçØ',
      'rain':      'üåßÔ∏è',
      'bow':       'üèπ',
      'butter':    'üßà',
      'fly':       'ü™∞',
      'book':      'üìö',
      'mark':      'üîñ',
      'water':     'üíß',
      'melon':     'üçâ',
      'key':       'üîë',
      'board':     'üìã',
      'flower':    'üå∏',
      'pan':       'üç≥',
      'cake':      'üéÇ',
      'birth':     'üë∂',
      'day':       'üìÖ',
      'gold':      'ü•á',
      'bed':       'üõå',
      'room':      'üè†',
      'door':      'üö™',
      'step':      'üë£',
      'glasses':   'üï∂Ô∏è',
      'rose':      'üåπ',
      'bud':       'üå±',
      'dragon':    'üêâ',
      'sea':       'üåä',
      'shell':     'üêö',
      'thunder':   '‚õàÔ∏è',
      'bolt':      '‚ö°',
      'fire':      'üî•',
      'wall':      'üß±',
      'wild':      'üåø',
      'card':      'üÉè',
      'check':     '‚úÖ',
      'point':     'üìç',
      'under':     '‚¨áÔ∏è',
      'world':     'üåç',
      'super':     'üí•',
      'hero':      'ü¶∏',
      'gem':       'üíé',
      'stone':     'ü™®',
      'heart':     '‚ù§Ô∏è',
      'sword':     'üó°Ô∏è',
      'sweet':     'üç¨',
      'back':      'üîô',
      'stage':     'üé≠',
      'dark':      'üåë',
      'horse':     'üê¥',
      'black':     '‚¨õ',
      'ice':       'üßä',
      'shadow':    'ü´•',
      'box':       'ü•ä',
      'blood':     'ü©∏',
      'hound':     'üêï',
      'break':     'üî®',
      'shine':     '‚ú®',
      'mine':      '‚õèÔ∏è',
      'craft':     'üèóÔ∏è',
      'fort':      'üè∞',
      'night':     'üåô',
      'game':      'üéÆ',
      'play':      '‚ñ∂Ô∏è',
      'war':       '‚öîÔ∏è',
      'dead':      'üíÄ',
      'ghost':     'üëª',
      'ship':      'üö¢',
      'speed':     'üí®',
      'power':     '‚ö°',
      'up':        '‚òùÔ∏è',
      'fall':      'üçÉ',
      'battle':    'üõ°Ô∏è',
      'field':     'üåæ',
      'arms':      'üí™',
      'over':      '‚¨ÜÔ∏è',
      'watch':     '‚åö',
      'skull':     'üíÄ',
      'cap':       'üß¢',
      'ball':      '‚öΩ',
      'lion':      'ü¶Å',
      'mind':      'üß†',
      'beast':     'üêó',
      'mode':      '‚öôÔ∏è',
      'king':      'üëë',
      'pin':       'üìå',
      'lord':      'üéñÔ∏è',
      'brand':     'üè∑Ô∏è',
      'robot':     'ü§ñ',
      'police':    'üëÆ',
      'silver':    'ü•à',
      'screen':    'üé¨',
      'storm':     'üå™Ô∏è',
      'rider':     'üèçÔ∏è',
      'golden':    '‚ú®',
      'age':       '‚è≥',
      'high':      'üèîÔ∏è',
      'land':      'üåø',
      'maker':     'üîß',
      'action':    'üé¨',
      'crystal':   'üîÆ',
      'diamond':   'üíé',
      'writer':    '‚úçÔ∏è',
      'current':   'üåä',
      'crown':     'üë∏',
      'head':      'üß†',
      'shot':      'üéØ',
      'run':       'üèÉ',
      'band':      'üéµ',
      'struck':    'üò≤',
      'ball2':     'üé±', // alternate ball for crystal ball
      'spring':    'üå∑',
      'time':      '‚è∞',
      'line':      'üìè',
      'hot':       'üå∂Ô∏è',
      'dog':       'üê∂',
      'cake2':     'üç∞', // cheesecake
      'cheese':    'üßÄ',
      'thunder2':  '‚ö°',
      'bird':      'üê¶',
      'cliff':     'ü™®',
      'hanger':    'üëó',
      'ham':       'ü•©',
      'tiger':     'üêÖ',
      'eye':       'üëÅÔ∏è',
      'lid':       'ü´£',
      // ‚îÄ‚îÄ new keys for idiom / compound batch ‚îÄ‚îÄ
      'witness':   'üßë‚Äç‚öñÔ∏è',
      'brain':     'üß†',
      'wash':      'üöø',
      'cold':      'ü•∂',
      'paper':     'üìÑ',
      'trail':     'ü•æ',
      'blind':     'üôà',
      'spot':      'üéØ',
      'chain':     '‚õìÔ∏è',
      'reaction':  'üí•',
      'double':    '2Ô∏è‚É£',
      'edge':      'üî™',
      'silent':    'ü§´',
      'false':     '‚ùå',
      'alarm':     'üö®',
      'deep':      'üåä',
      'freeze':    'üßä',
      'memory':    'üí≠',
      'lane':      'üõ£Ô∏è',
      'last':      'üèÅ',
      'stand':     'ü™ñ',
      'heavy':     'üèãÔ∏è',
      'open':      'üîì',
      'secret':    'ü§ê',
      'lining':    'üå§Ô∏è',
      // ‚îÄ‚îÄ new keys for function-word compound batch ‚îÄ‚îÄ
      'after':     '‚è≠Ô∏è',
      'shock':     '‚ö°',
      'take':      'ü§≤',
      'every':     'üåê',
      'where':     'üìç',
      'some':      'üî¢',
      'thing':     'üì¶',
      'any':       '‚ôæÔ∏è',
      'there':     'üëâ',
      'fore':      'üîú',
      'more':      '‚ûï',
      'never':     'üö´',
      'with':      'ü§ù',
      'out':       'üö™',
      'into':      '‚û°Ô∏è',
      'side':      '‚ÜîÔ∏è',
      'life':      'üå±',
    };

    function renderClueChips(elId, images, isHost) {
      const el = document.getElementById(elId);
      if (!el) return;
      if (!images || !images.length) { el.innerHTML = ''; return; }
      const cls = isHost ? 'clue-chip-host' : 'clue-chip';
      el.innerHTML = images.map(w => {
        const emoji = CLUE_EMOJI[w.toLowerCase()] || 'üñºÔ∏è';
        return `<div class="${cls}" title="${w}">${emoji}</div>`;
      }).join('');
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // INIT ‚Äî auto-connect Firebase
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    window.addEventListener('load', function () {
      document.getElementById('loading-overlay').classList.add('hidden');
      if (typeof firebase === 'undefined') {
        alert('‚ö†Ô∏è Firebase SDK failed to load. Please check your internet connection and reload.');
        return;
      }
      initFirebase(FIREBASE_URL);
      showScreen('host-login');
    });
  </script>
</body>

</html>
